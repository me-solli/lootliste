<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>üõ† Admin ‚Äì Lootliste</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b0b0b;
  --panel:#121212;
  --border:#2a2a2a;
  --gold:#f5c451;
  --ok:#4cff4c;
  --err:#ff5c5c;
  --muted:#888;
  --btn:#2e7d32;
  --btn2:#444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(ellipse at top,#1c1c1c 0%,#0b0b0b 65%);
  color:#eaeaea;
}

.wrapper{
  max-width:1200px;
  margin:40px auto;
  padding:20px;
}

.panel{
  background:linear-gradient(180deg,#161616,#0e0e0e);
  border:1px solid var(--border);
  border-radius:16px;
  padding:22px;
}

h1{
  margin:0 0 16px;
  color:var(--gold);
}

.tabs{
  margin-bottom:16px;
}

.tabs button{
  margin-right:6px;
  padding:8px 12px;
  background:var(--btn2);
  border:none;
  border-radius:8px;
  color:#fff;
  cursor:pointer;
  opacity:.6;
}

.tabs button.active{
  opacity:1;
  background:var(--btn);
}

.item{
  display:flex;
  gap:18px;
  padding:16px 0;
  border-bottom:1px solid var(--border);
}

.item:last-child{border-bottom:none}

.thumb{
  width:200px;
  flex-shrink:0;
}

.thumb img{
  width:100%;
  border-radius:10px;
  border:1px solid var(--border);
  background:#000;
}

.actions button{
  margin-right:6px;
  margin-top:8px;
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.approve{background:#2e7d32;color:#fff}
.hide{background:#555;color:#fff}
.reject{background:#7d2e2e;color:#fff}

.meta{
  flex:1;
  font-size:14px;
}

.meta div{margin-bottom:6px}

.empty,.error{
  padding:30px;
  text-align:center;
  color:var(--muted);
}
.error{color:var(--err)}
</style>
</head>

<body>
<div class="wrapper">
  <div class="panel">
    <h1>Admin ‚Äì Lootliste</h1>

    <div class="tabs" id="tabs">
      <button data-status="submitted" class="active">üïí Eingereicht</button>
      <button data-status="approved">‚úÖ Freigegeben</button>
      <button data-status="hidden">üëÅÔ∏è Versteckt</button>
      <button data-status="rejected">‚ùå Abgelehnt</button>
    </div>

    <div id="list"></div>
  </div>
</div>

<script>
/* ================================
   CONFIG
================================ */
const API_BASE = "https://content-connection-production-ea07.up.railway.app";
const ADMIN_TOKEN = "lootliste-admin-2025";

let currentStatus = "submitted";
const list = document.getElementById("list");

/* ================================
   LOAD
================================ */
async function loadItems(){
  list.innerHTML = "Lade Items‚Ä¶";

  try{
    const res = await fetch(
      `${API_BASE}/api/admin/items?status=${currentStatus}`,
      { headers:{ "x-admin-token": ADMIN_TOKEN } }
    );

    if(!res.ok) throw new Error(res.status);
    const items = await res.json();

    if(!items.length){
      list.innerHTML = `<div class="empty">Keine Items.</div>`;
      return;
    }

    list.innerHTML = items.map(item => `
      <div class="item">
        <div class="thumb">
          <img src="${API_BASE}${item.screenshot}">
          <div class="actions">
            ${currentStatus==="submitted" ? `
              <button class="approve" onclick="approve(${item.id})">Freigeben</button>
              <button class="reject" onclick="rejectItem(${item.id})">Ablehnen</button>
            ` : ""}
            ${currentStatus==="approved" ? `
              <button class="hide" onclick="hideItem(${item.id})">Verstecken</button>
            ` : ""}
          </div>
        </div>
        <div class="meta">
          <div><b>ID:</b> ${item.id}</div>
          <div><b>Status:</b> ${item.status}</div>
          <div><b>Titel:</b> ${item.title || "-"}</div>
          <div><b>Typ:</b> ${item.type || "-"}</div>
          <div><b>Rating:</b> ${item.rating ?? "-"}</div>
          <div><b>Erstellt:</b> ${new Date(item.created_at).toLocaleString()}</div>
        </div>
      </div>
    `).join("");

  }catch(e){
    console.error(e);
    list.innerHTML = `<div class="error">‚ö†Ô∏è Fehler beim Laden</div>`;
  }
}

/* ================================
   ACTIONS
================================ */
async function action(path, body){
  await fetch(API_BASE+path,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "x-admin-token":ADMIN_TOKEN
    },
    body: body ? JSON.stringify(body) : null
  });
  loadItems();
}

const approve = id => action(`/api/admin/items/${id}/approve`);
const hideItem = id => action(`/api/admin/items/${id}/hide`);
const rejectItem = id => {
  const note = prompt("Ablehnungsgrund (optional):");
  action(`/api/admin/items/${id}/reject`,{admin_note:note});
};

/* ================================
   TABS
================================ */
document.getElementById("tabs").onclick = e => {
  if(!e.target.dataset.status) return;
  currentStatus = e.target.dataset.status;
  document.querySelectorAll(".tabs button")
    .forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");
  loadItems();
};

loadItems();
</script>
</body>
</html>
