<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Meine Items – Lootliste</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#0b0b0b;
  color:#eaeaea;
}

.wrapper{
  max-width:1100px;
  margin:0 auto;
  padding:30px 20px;
}

h1{
  font-size:22px;
  margin-bottom:6px;
}

.sub{
  font-size:13px;
  opacity:.7;
  margin-bottom:22px;
}

.items{
  display:grid;
  gap:14px;
}

.item{
  padding:16px 18px;
  border:1px solid #2a2a2a;
  border-radius:14px;
  background:#121212;
}

.item-name{
  font-size:16px;
  font-weight:600;
}

.item-meta{
  margin-top:6px;
  font-size:13px;
  opacity:.85;
}

.status{
  margin-top:8px;
  font-size:13px;
}

.status.verfügbar{ color:#4cff4c }
.status.reserviert{ color:#f5c451 }
.status.vergeben{ color:#8fd1ff }

.empty{
  padding:18px;
  border:1px dashed #333;
  border-radius:14px;
  opacity:.7;
  font-size:14px;
}
</style>
</head>

<body>
<div class="wrapper">

<h1>Meine eingereichten Items</h1>
<div class="sub">Items, die wirklich deiner aktuellen User-ID gehören</div>

<div id="list" class="items"></div>

</div>

<script>
/* ===============================
   CONFIG
=============================== */
const API = "https://lootliste-production.up.railway.app";
const ACTIVE_SEASON = "non-ladder";
const list = document.getElementById("list");

/* ===============================
   START
=============================== */
loadMyItems();

/* ===============================
   LOAD MY ITEMS (HART & TRANSPARENT)
=============================== */
async function loadMyItems(){
  list.innerHTML = "";

  const userId = localStorage.getItem("lootliste_user_id");

  if (!userId) {
    list.innerHTML =
      "<div class='empty'>Keine User-ID im Browser gefunden.</div>";
    return;
  }

  console.log("MY-ITEMS → LOCAL USER ID:", userId);

  const res = await fetch(API + "/items", {
    headers: {
      "X-User-Id": userId
    }
  });

  const items = await res.json();

  console.log("MY-ITEMS → TOTAL ITEMS:", items.length);
  console.log("MY-ITEMS → RAW ITEMS:", items);

  const mine = items.filter(i =>
    i.donorId === userId &&
    (i.season ?? "non-ladder") === ACTIVE_SEASON
  );

  console.log("MY-ITEMS → MATCHING ITEMS:", mine);

  if (mine.length === 0) {
    list.innerHTML =
      "<div class='empty'>Kein Item im Backend hat <b>donorId = " + userId + "</b>.</div>";
    return;
  }

  mine.forEach(item => {
    const el = document.createElement("div");
    el.className = "item";

    el.innerHTML = `
      <div class="item-name">${item.name}</div>

      <div class="item-meta">
        Kategorie: ${item.type || "–"} ·
        Erstellt: ${
          item.createdAt
            ? new Date(item.createdAt).toLocaleDateString("de-DE")
            : "–"
        }
      </div>

      <div class="status ${item.status}">
        Status: ${item.status}
      </div>
    `;

    list.appendChild(el);
  });
}
</script>

</body>
</html>
