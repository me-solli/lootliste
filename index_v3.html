<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>üéÅ D2R Lootliste ‚Äì V3 Test Phase 2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --gold:#f5c451;
  --border:#2a2a2a;
  --green:#4cff4c;
  --yellow:#ffd24c;
  --panel:#121212;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#0b0b0b;
  color:#eaeaea;
}
.wrapper{max-width:1200px;margin:0 auto}

/* ===== HEADER ===== */
header{
  padding:30px;
  background:linear-gradient(180deg,#1a1a1a,#0b0b0b);
  border-bottom:1px solid #222;
  position:relative;
}
header h1{margin:0;color:var(--gold)}
header p{margin:6px 0 0;opacity:.85}

/* ===== AUTH ===== */
.auth-box{
  position:absolute;
  top:24px;
  right:24px;
  display:flex;
  gap:8px;
  align-items:center;
  font-size:13px;
}
.auth-box button{
  padding:6px 12px;
  background:#151515;
  border:1px solid var(--border);
  border-radius:10px;
  color:#fff;
  cursor:pointer;
}
.auth-box button:hover{border-color:var(--gold);color:var(--gold)}

.container{padding:30px}

/* ===== CARDS ===== */
.cards{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:22px;
}
@media(max-width:700px){.cards{grid-template-columns:1fr}}

.card{
  background:linear-gradient(180deg,#191919,#0f0f0f);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  position:relative;
}

.status{
  position:absolute;
  top:12px;
  right:12px;
  font-size:12px;
  padding:4px 10px;
  border-radius:999px;
}
.verfuegbar{background:rgba(76,255,76,.15);color:var(--green)}
.bedarf{background:rgba(255,210,76,.15);color:var(--yellow)}

.cta{
  margin-top:10px;
  padding:8px;
  text-align:center;
  border:1px solid var(--border);
  border-radius:12px;
  cursor:pointer;
}
.cta:hover{border-color:var(--gold);color:var(--gold)}

.owner-box{
  margin-top:12px;
  padding:10px;
  border:1px dashed #333;
  border-radius:12px;
  font-size:13px;
  background:#111;
}
.owner-box b{color:var(--gold)}
.owner-entry{margin-top:6px;opacity:.9}

footer{
  margin-top:50px;
  padding:22px;
  border-top:1px solid #222;
  font-size:13px;
}
</style>
</head>

<body>
<div class="wrapper">

<header>
  <div class="auth-box">
    <span id="authState">üë§ nicht eingeloggt</span>
    <button id="loginA">Tester_A</button>
    <button id="loginB">Tester_B</button>
    <button id="logout">Logout</button>
  </div>
  <h1>D2R Lootliste</h1>
  <p>V3 ¬∑ Testbetrieb ¬∑ Phase 2 (Owner-Sichtbarkeit)</p>
</header>

<div class="container">
  <div class="cards" id="cards"></div>
</div>

<footer>
  Testdatei ¬∑ nichts hiervon ist final
</footer>

</div>

<script>
/* =====================================================
   AUTH (lokale Test-Accounts)
===================================================== */
const USERS={
  A:{id:"u1",name:"Tester_A"},
  B:{id:"u2",name:"Tester_B"}
};

function setUser(u){
  localStorage.setItem("v3_user",JSON.stringify(u));
  renderAuth();
  renderItems();
}
function getUser(){
  try{return JSON.parse(localStorage.getItem("v3_user"))}
  catch{return null}
}
function logout(){
  localStorage.removeItem("v3_user");
  renderAuth();
  renderItems();
}

loginA.onclick=()=>setUser(USERS.A);
loginB.onclick=()=>setUser(USERS.B);
logout.onclick=logout;

function renderAuth(){
  const u=getUser();
  authState.textContent=u?"üë§ "+u.name:"üë§ nicht eingeloggt";
}
renderAuth();

/* =====================================================
   ITEMS + DEMAND
===================================================== */
const KEY="v3_items_phase2";

function loadItems(){
  const d=localStorage.getItem(KEY);
  if(d) return JSON.parse(d);
  const seed=[
    {id:"i1",name:"Shako",owner:"u1",status:"Verf√ºgbar",demand:[]},
    {id:"i2",name:"Der Himmelsriss",owner:"u2",status:"Verf√ºgbar",demand:[]}
  ];
  localStorage.setItem(KEY,JSON.stringify(seed));
  return seed;
}
function saveItems(items){
  localStorage.setItem(KEY,JSON.stringify(items));
}

function requestItem(id){
  const u=getUser();
  if(!u){alert("Bitte einloggen");return;}
  const items=loadItems();
  const item=items.find(i=>i.id===id);

  if(item.owner===u.id){
    alert("Eigenes Item kann nicht angefragt werden.");
    return;
  }
  if(item.demand.find(d=>d.by===u.id)){
    alert("Du hast bereits Bedarf gemeldet.");
    return;
  }

  item.demand.push({by:u.id,name:u.name,time:Date.now()});
  item.status="Bedarf vorhanden";
  saveItems(items);
  renderItems();
}

function renderItems(){
  const items=loadItems();
  const u=getUser();
  cards.innerHTML="";

  items.forEach(item=>{
    const div=document.createElement("div");
    const isOwner=u && u.id===item.owner;

    div.className="card";
    div.innerHTML=`
      <span class="status ${item.status==="Verf√ºgbar"?"verfuegbar":"bedarf"}">
        ${item.status}
      </span>

      <strong>${item.name}</strong><br>
      <small>Owner: ${item.owner}</small><br>
      <small>üì¨ Anfragen: ${item.demand.length}</small>

      <div class="cta">Item anfragen</div>

      ${isOwner && item.demand.length ? `
        <div class="owner-box">
          <b>Anfragen:</b>
          ${item.demand.map(d=>`
            <div class="owner-entry">
              ‚Ä¢ ${d.name}
              <span style="opacity:.6">
                (${new Date(d.time).toLocaleString("de-DE")})
              </span>
            </div>
          `).join("")}
        </div>
      `:""}
    `;

    div.querySelector(".cta").onclick=()=>requestItem(item.id);
    cards.appendChild(div);
  });
}

renderItems();
</script>

</body>
</html>
