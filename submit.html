<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Items einreichen â€“ Lootliste</title>

<style>
:root{
  --bg:#0b0b0b;
  --panel:#141414;
  --panel-soft:#1c1c1c;
  --border:#2a2a2a;
  --gold:#f5c451;
  --text:#eaeaea;
  --muted:#9a9a9a;
  --ok:#4cff4c;
  --bad:#ff5c5c;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(ellipse at top,#1a1a1a 0%,#090909 65%);
  color:var(--text);
}

/* ===== HEADER ===== */
header{
  padding:30px 34px 28px;
  background:linear-gradient(180deg,#1d1d1d,#0d0d0d);
  border-bottom:1px solid var(--border);
}

header h1{
  margin:0;
  color:var(--gold);
  font-size:32px;
}

header p{
  margin:10px 0 0;
  color:var(--muted);
  font-size:15px;
}

/* ===== MAIN ===== */
main{
  max-width:1200px;
  margin:0 auto;
  padding:32px 26px 80px;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(420px,1fr));
  gap:28px;
}

/* ===== PANEL ===== */
.panel{
  background:linear-gradient(180deg,#1a1a1a,#0f0f0f);
  border:1px solid var(--border);
  border-radius:24px;
  padding:22px 24px 26px;
}

.panel h3{
  margin:0 0 6px;
  font-size:18px;
  color:var(--gold);
}

.subtitle{
  font-size:13px;
  color:var(--muted);
  margin-bottom:18px;
}

/* ===== PHASE ===== */
.phases{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
}

.phase{
  background:var(--panel-soft);
  border:1px dashed var(--border);
  border-radius:18px;
  padding:16px 18px;
}

.block-title{
  font-size:11px;
  letter-spacing:.8px;
  color:var(--gold);
  margin:6px 0 6px;
  text-transform:uppercase;
}

input[type="file"],
input[type="text"]{
  width:100%;
  padding:8px;
  background:#0b0b0b;
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--text);
  font-size:13px;
}

input[type="file"]{
  cursor:pointer;
}

/* ===== PREVIEW ===== */
.preview{
  display:none;
  margin-top:10px;
}

.preview img{
  width:100%;
  border-radius:12px;
  border:1px solid var(--border);
}

/* ===== ACTION ===== */
.action{
  margin-top:18px;
}

button{
  padding:12px 22px;
  border-radius:16px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--gold);
  font-size:13px;
  cursor:pointer;
}

button:hover{
  box-shadow:0 0 0 1px rgba(245,196,81,.45);
}

button:disabled{
  opacity:.5;
  cursor:not-allowed;
}

.msg{
  margin-top:14px;
  font-size:13px;
}

.msg.ok{color:var(--ok)}
.msg.error{color:var(--bad)}
</style>
</head>

<body>

<header>
  <h1>Items einreichen</h1>
  <p>Screenshots werden geprÃ¼ft und anschlieÃŸend in die Lootliste Ã¼bernommen.</p>
</header>

<main>

<form id="submitForm">
<div class="dashboard">

  <!-- ITEM 1 -->
  <div class="panel">
    <h3>ðŸ“¦ Item 1</h3>
    <div class="subtitle">Pflicht</div>

    <div class="phases">
      <div class="phase">
        <div class="block-title">Screenshot</div>
        <input type="file" name="screenshot_1" accept="image/*" required data-preview="p1">
        <div class="preview" id="p1"></div>

        <div class="block-title">Notiz (optional)</div>
        <input type="text" name="note_1" maxlength="50">
      </div>
    </div>
  </div>

  <!-- ITEM 2 -->
  <div class="panel">
    <h3>ðŸ“¦ Item 2</h3>
    <div class="subtitle">Optional</div>

    <div class="phases">
      <div class="phase">
        <div class="block-title">Screenshot</div>
        <input type="file" name="screenshot_2" accept="image/*" data-preview="p2">
        <div class="preview" id="p2"></div>

        <div class="block-title">Notiz (optional)</div>
        <input type="text" name="note_2" maxlength="50">
      </div>
    </div>
  </div>

</div>

<input type="hidden" name="item_count" id="itemCount" value="1">

<div class="action">
  <button type="submit" id="submitBtn">Item(s) einreichen</button>
  <div id="msg" class="msg"></div>
</div>
</form>

</main>

<script>
const API="https://lootliste-production.up.railway.app";

/* Preview */
document.querySelectorAll('input[type="file"][data-preview]').forEach(i=>{
  i.addEventListener("change",()=>{
    const box=document.getElementById(i.dataset.preview);
    box.innerHTML="";
    if(!i.files[0]){box.style.display="none";return;}
    const img=document.createElement("img");
    img.src=URL.createObjectURL(i.files[0]);
    box.appendChild(img);
    box.style.display="block";
  });
});

/* Submit */
const form=document.getElementById("submitForm");
const msg=document.getElementById("msg");
const btn=document.getElementById("submitBtn");
const cnt=document.getElementById("itemCount");

form.addEventListener("submit",async e=>{
  e.preventDefault();
  msg.textContent="";
  msg.className="msg";

  const fd=new FormData(form);
  let c=0;
  ["1","2"].forEach(n=>{
    const f=fd.get("screenshot_"+n);
    if(f&&f.name)c++;
  });
  if(!c){msg.textContent="Mindestens ein Screenshot erforderlich.";msg.classList.add("error");return;}
  cnt.value=c;
  btn.disabled=true;

  try{
    const r=await fetch(API+"/api/items",{method:"POST",headers:{"x-login-id":"dev-admin"},body:fd});
    if(!r.ok)throw new Error("Upload fehlgeschlagen");
    msg.textContent="âœ” Upload erfolgreich";
    msg.classList.add("ok");
    form.reset();
    document.querySelectorAll(".preview").forEach(p=>p.style.display="none");
  }catch(e){
    msg.textContent="âœ– "+e.message;
    msg.classList.add("error");
  }finally{
    btn.disabled=false;
  }
});
</script>

</body>
</html>
