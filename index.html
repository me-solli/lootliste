<!DOCTYPE html>
<!--
  ================================
  LOOTLISTE â€“ BLANCO V2 (CLEAN BASE)
  Basis: alte index.html (OPTIK)
  Ziel: saubere Struktur + FAKE-BlÃ¶cke
  Keine aktive Logik
  ================================
-->
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Free Lootliste â€“ Community Items | D2R Non-Ladder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FAVICON -->
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<style>
/* ================================
   DESIGN TOKENS (aus alter index)
================================ */
:root{
  --gold:#f5c451;
  --bg:#0b0b0b;
  --panel:#121212;
  --border:#2a2a2a;
  --soft:#1a1a1a;
  --green:#4cff4c;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(ellipse at top,#181818 0%,#090909 65%);
  color:#eaeaea;
}

.wrapper{max-width:1500px;margin:0 auto}

/* ================================
   HERO (OPTIK FINAL â€“ BALANCED)
================================ */
.hero{
  background:url("img/banner_diablo.png") center top / cover no-repeat;
  border-radius:0 0 26px 26px;
  overflow:hidden;
  min-height:240px;          /* â†‘ bewusst wieder Luft */
  position:relative;
}

.hero-inner{
  padding:36px 36px;         /* â†‘ nicht riesig, aber atmend */
  background: linear-gradient(
    to bottom,
    rgba(0,0,0,.28),
    rgba(0,0,0,.72)
  );
}

.hero-logo img{
  max-width:440px;           /* â†‘ Logo wieder etwas prÃ¤senter */
  width:100%;
  filter:brightness(.82) contrast(1.05)
          drop-shadow(0 0 10px rgba(0,0,0,.6));
}

.hero p{
  margin:10px 0 16px;        /* zurÃ¼ck zu natÃ¼rlichem Rhythmus */
  opacity:.9;
}

.mode-banner{
  margin:-2px 0 18px;        /* weniger aggressiv nach oben */
  font-size:13px;
  letter-spacing:.3px;
  color:#dcdcdc;
}

.mode-banner strong{color:var(--green)}
.mode-banner span{opacity:.7;font-size:12px}

.hero-stats{
  display:flex;
  gap:16px;                  /* etwas mehr Luft */
  flex-wrap:wrap;
  font-size:14px;            /* wieder ruhiger lesbar */
}

.hero-stats div{
  padding:7px 14px;          /* nicht mehr gequetscht */
  background:rgba(0,0,0,.4);
  border:1px solid var(--border);
  border-radius:999px;
}

.auth-box{
  position:absolute;
  top:22px;
  right:24px;
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px 14px;
  border:1px solid var(--border);
  border-radius:14px;
  background:rgba(0,0,0,.55);
  font-size:13px;
}

.auth-link{
  margin-left:8px;
  font-size:12px;
  color:#f5c451;
  text-decoration:none;
  opacity:.85;
}

.auth-link:hover{
  opacity:1;
  text-decoration:underline;
}

  .auth-sep{
  margin:0 4px;
  opacity:.5;
  font-size:12px;
}

  /* ================================
   TOAST FEEDBACK (MINIMAL)
================================ */
.toast{
  position:fixed;
  bottom:22px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 16px;
  border-radius:999px;
  background:rgba(0,0,0,.75);
  border:1px solid rgba(245,196,81,.4);
  color:#f5c451;
  font-size:13px;
  z-index:9999;
  box-shadow:0 0 18px rgba(245,196,81,.35);
}
  
/* ================================
   PROJECT TIMELINE (OPTIK)
================================ */
.project-timeline{
  padding:10px 28px 12px;
  background:linear-gradient(
    180deg,
    rgba(0,0,0,.28),
    rgba(0,0,0,0)
  );
}

/* Label */
.timeline-label{
  padding:4px 0 6px;
  font-size:12px;
  color:#bfa86a;
  opacity:.75;
}

/* Track */
.timeline-track{
  height:1px;
  background:#2a2a2a;
  position:relative;
  margin-bottom:10px;
}

.timeline-progress{
  position:absolute;
  left:0;
  top:0;
  height:1px;
  width:75%;
  background:linear-gradient(90deg,#bfa86a,#6f7f4a);
}

/* Steps */
.timeline-steps{
  display:flex;
  justify-content:space-between;
  margin-bottom:14px;
}

.timeline-step{
  width:14px;
  height:14px;
  border-radius:50%;
  background:#2a2a2a;
}

.timeline-step.done{background:#bfa86a}
.timeline-step.current{background:#6f7f4a}
.timeline-step.future{background:#333;opacity:.5}

/* ================================
   RULES / FLOW BOX (IN TIMELINE)
================================ */
.rules-box{
  margin-top:6px;
  padding:14px 18px;
  border:1px solid rgba(191,168,106,.35);
  border-radius:14px;
  font-size:13px;
  background:rgba(0,0,0,.25);
  box-shadow:
    inset 0 0 12px rgba(191,168,106,.08);
  opacity:.9;
}

.rules-box strong{
  display:block;
  margin-bottom:6px;
  color:#bfa86a;
  font-weight:600;
}

.rules-box p{
  margin:6px 0;
  line-height:1.45;
}

.rules-link{
  display:inline-block;
  margin-top:6px;
  color:var(--gold);
  text-decoration:none;
  font-weight:500;
}

.rules-link:hover{
  text-decoration:underline;
}

/* ================================
   ICON BAR (DIABLO â€“ RUHIG & EINGEBETTET)
================================ */

.icon-bar{
  display:flex;
  gap:12px;
  padding:18px 28px 20px;
  overflow-x:auto;
  background:transparent;
  border-bottom:1px solid rgba(255,255,255,.06);

  justify-content:center; /* ğŸ‘ˆ neu */
}

/* ================================
   ICON BUTTON â€“ BASIS (RUHIG, EINGEBETTET)
================================ */

.icon-btn{
  min-width:96px;
  text-align:center;
  padding:14px 10px 12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.08);
  background:transparent;
  transition:
    border-color .25s ease,
    box-shadow .25s ease;
}

/* Icon */
.icon-btn img{
  width:68px;
  height:68px;
  margin-bottom:10px;
  opacity:.8;
  filter:
    drop-shadow(0 0 4px rgba(0,0,0,.9));
  transition:
    opacity .3s ease,
    filter .3s ease;
}

/* Label */
.icon-btn span{
  display:block;
  font-size:13px;
  letter-spacing:.3px;
  color:#d2d2d2;
  opacity:.8;
}

/* ================================
   HOVER â€“ LEICHTE ORIENTIERUNG
================================ */

.icon-btn:hover{
  border-color:rgba(255,215,120,.25);
  box-shadow:0 0 6px rgba(255,215,120,.15);
}

.icon-btn:hover img{
  opacity:.95;
  filter:
    drop-shadow(0 0 6px rgba(255,215,120,.25))
    drop-shadow(0 0 14px rgba(0,0,0,.9));
}

/* ================================
   ACTIVE â€“ LEISER STATUS (KEIN CTA)
================================ */

.icon-btn.active{
  border-color:rgba(255,215,120,.28);
  box-shadow:0 0 6px rgba(255,215,120,.18);
}

.icon-btn.active img{
  filter:
    drop-shadow(0 0 14px rgba(255,215,120,.65))
    drop-shadow(0 0 22px rgba(0,0,0,.95));
}

/* ================================
   ICON BAR â€“ SCROLL FEINSCHLIFF
================================ */

.icon-bar{
  scrollbar-width:thin;
  scrollbar-color:rgba(245,196,81,.35) transparent;
}

.icon-bar::-webkit-scrollbar{
  height:6px;
}

.icon-bar::-webkit-scrollbar-track{
  background:transparent;
}

.icon-bar::-webkit-scrollbar-thumb{
  background:rgba(245,196,81,.3);
  border-radius:6px;
}

/* ================================
   CONTENT / META / FILTER
================================ */
.container{padding:30px}
.meta-bar{display:flex;gap:18px;margin-bottom:18px;font-size:13px}
 .filter-panel{background:#121212;border:1px solid var(--border);border-radius:18px;padding:18px;margin-bottom:18px}
.filter-panel input,.filter-panel select{padding:10px 12px;background:#111;border:1px solid #333;color:#fff;border-radius:10px}

/* ================================
   CARDS (OPTIK BASIS â€“ KOMPAKT)
================================ */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(320px, 360px));
  gap:18px;
  justify-content:center;
}

.card{
  display:flex;
  flex-direction:column;
  background:linear-gradient(180deg,#191919,#0f0f0f);
  border:1px solid var(--border);
  border-radius:20px;
  overflow:hidden;
}

.card-image{
  width:120px;
  background:#0b0b0b;
  display:flex;
  align-items:center;
  justify-content:center;
}

.card-image img{
  width:72px;
  height:72px;
}

.card-body{
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:6px;
}

/* NAME IMMER EINZEILIG */
.item-name{
  font-size:16px;
  font-weight:600;

  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}

.item-sub{
  font-size:11px;
  color:#8a8a8a;
  letter-spacing:.6px;
  text-transform:uppercase;
}

.stars{
  color:var(--gold);
}

.player{
  font-size:13px;
  opacity:.85;
}

/* ================================
   FAKE BLOCKS (VISUAL)
================================ */
.fake-block{
  margin:16px 0;
  padding:14px 16px;
  border:1px dashed rgba(255,255,255,.15);
  border-radius:12px;
  font-size:13px;
  color:#bbb;
  background:rgba(255,255,255,.03);
}
.fake-block strong{color:var(--gold)}

/* ================================
   FOOTER
================================ */
.footer{margin-top:50px;padding:22px;border-top:1px solid #222;font-size:13px;text-align:center}
.footer a{color:var(--gold);text-decoration:none}

  /* ================================
   FILTER UI (BASIC)
================================ */
.filter-row{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}

.filter-row input{
  flex:1;
  min-width:220px;
}

.filter-row select{
  min-width:160px;
}

.hero-stat{
  padding:8px 14px;
  background:rgba(0,0,0,.4);
  border:1px solid var(--border);
  border-radius:999px;
}

  .auth-box img{
  border-radius:50%;
}

.auth-btn{
  padding:6px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#111;
  color:#fff;
  font-size:12px;
  cursor:pointer;
}

  /* ================================
   SCREENSHOT OVERLAY
================================ */
.overlay{
  position:fixed;
  inset:0;
  z-index:9999;
}

.overlay-backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.75);
}

.overlay-content{
  position:relative;
  z-index:1;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100%;
}

.overlay-content img{
  max-width:90%;
  max-height:90%;
  border-radius:12px;
  box-shadow:0 0 40px rgba(0,0,0,.8);
}

  .footer-meta{
  margin-top:10px;
  opacity:.75;
  font-size:12px;
}

  /* ================================
   UX â€“ ICON BAR FEEDBACK
================================ */
.icon-btn{
  cursor:pointer;
  transition:transform .15s ease, background .15s ease, border-color .15s ease;
}

.icon-btn:hover{
  transform:translateY(-2px);
  background:rgba(255,255,255,.04);
}

.icon-btn.active{
  border-color:var(--gold);
  background:rgba(245,196,81,.08);
}

  /* ================================
   UX â€“ CARDS HOVER & CLICK
================================ */
.card{
  cursor:pointer;
  transition:transform .15s ease, box-shadow .15s ease;
}

.card:hover{
  transform:translateY(-3px);
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}

.card-image{
  cursor:zoom-in;
}

  /* ================================
   UX â€“ FILTER FOCUS
================================ */
.filter-panel input:focus,
.filter-panel select:focus{
  outline:none;
  border-color:var(--gold);
  box-shadow:0 0 0 1px rgba(245,196,81,.3);
}

  /* ================================
   UX â€“ RESULTS INFO
================================ */
.results-info{
  margin:-6px 0 12px;
  font-size:13px;
  opacity:.75;
}

  /* ================================
   UX â€“ SKELETON LOADING
================================ */
.skeletons{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:22px;
}

.skeleton-card{
  height:140px;
  border-radius:20px;
  background:linear-gradient(
    90deg,
    #1a1a1a 25%,
    #222 37%,
    #1a1a1a 63%
  );
  background-size:400% 100%;
  animation:skeleton 1.2s ease-in-out infinite;
}

@keyframes skeleton{
  0%{background-position:100% 0}
  100%{background-position:0 0}
}

  /* ================================
   UX â€“ CARD FADE IN
================================ */
.card{
  opacity:0;
  transform:translateY(6px);
  animation:cardFade .35s ease forwards;
}

@keyframes cardFade{
  to{
    opacity:1;
    transform:translateY(0);
  }
}

  /* ================================
   ICON BAR â€“ GOLD FRAME + GLOW
================================ */
.icon-btn{
  position:relative;
  border:1px solid rgba(245,196,81,.25);
  border-radius:14px;
  padding:10px 12px;
  transition:
    border-color .2s ease,
    box-shadow .2s ease,
    transform .15s ease,
    background .2s ease;
}

/* Hover â€“ dezenter Goldschein */
.icon-btn:hover{
  border-color:rgba(245,196,81,.6);
  box-shadow:
    0 0 0 1px rgba(245,196,81,.25),
    0 0 14px rgba(245,196,81,.25);
}

/* Active â€“ klarer Diablo-Gold-Look */
.icon-btn.active{
  border-color:var(--gold);
  background:rgba(245,196,81,.08);
  box-shadow:
    0 0 0 1px rgba(245,196,81,.6),
    0 0 18px rgba(245,196,81,.55),
    inset 0 0 12px rgba(245,196,81,.15);
}

/* Icon leicht hervorheben */
.icon-btn.active img{
  filter:drop-shadow(0 0 6px rgba(245,196,81,.8));
}

/* ================================
   SLOGAN LINE (DIABLO STYLE)
================================ */
.slogan-line{
  margin:28px 0 36px;
  padding:14px 0;
  text-align:center;
  font-size:18px;
  letter-spacing:1.1px;
  opacity:.9;
  color:#e0e0e0;

  background:
    linear-gradient(
      90deg,
      transparent,
      rgba(255,255,255,.06),
      transparent
    );
}

  /* ================================
   FOOTER LINKS
================================ */
.footer-links{
  margin-bottom:8px;
}

.footer-links a{
  color:#aaa;
  text-decoration:none;
  font-size:12px;
}

.footer-links a:hover{
  color:var(--gold);
  text-decoration:underline;
}

.footer-links span{
  margin:0 6px;
  opacity:.5;
}

.footer-note{
  font-size:11px;
  opacity:.55;
}

/* ================================
   PROJECT STATUS (FINAL â€“ KOMPAKT)
================================ */

.project-status{
  margin:14px 28px 8px;
  padding:10px 16px 12px;
  border:1px solid rgba(255,255,255,.07);
  border-radius:14px;
  background:linear-gradient(
    to bottom,
    rgba(255,255,255,.03),
    rgba(255,255,255,.015)
  );
}

/* ================================
   RECENT ITEMS FEED (MINIMAL + ICON)
================================ */

.recent-feed{
  margin: 6px 28px 12px;
  padding: 10px 14px 12px;
  background: rgba(0,0,0,.22);
  border-radius: 14px;
}

.recent-feed-title{
  font-size: 12px;
  letter-spacing: .4px;
  text-transform: uppercase;
  color: #9a9a9a;
  margin-bottom: 6px;
}

.recent-feed-list{
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* ğŸ”‘ Feed-Eintrag */
.recent-feed-item{
  display: flex;
  align-items: center;
  gap: 8px;

  font-size: 12px;
  color: #cfcfcf;
  opacity: .9;
}

/* ğŸ§± Mini Item Icon */
.recent-feed-icon{
  width: 22px;
  height: 22px;
  border-radius: 6px;
  background-size: cover;
  background-position: center;
  background-color: rgba(0,0,0,.35);

  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06);

  flex-shrink: 0;
  opacity: .85;
}

.recent-feed-item a{
  color: #e6c36a;
  text-decoration: none;
}

.recent-feed-item a:hover{
  text-decoration: underline;
}

/* ================================
   PROJECT STATUS (UNVERÃ„NDERT)
================================ */

/* Kopfzeile */
.status-line{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:13px;
  color:#d2d2d2;
}

/* Punkt */
.status-dot{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#6f7f4a;
  box-shadow:0 0 6px rgba(111,127,74,.6);
}

/* Status */
.status-text strong{
  color:#eaeaea;
  font-weight:600;
}

/* Subline */
.status-note{
  margin-top:4px;
  font-size:12px;
  color:#9a9a9a;
  letter-spacing:.2px;
}

/* Button-Zone */
.status-actions{
  margin-top:10px;
}

/* Button */
.status-btn{
  display:inline-block;
  padding:6px 14px;
  font-size:12px;
  border-radius:999px;
  text-decoration:none;

  color:var(--gold);
  border:1px solid rgba(245,196,81,.35);
  background:rgba(245,196,81,.05);

  transition:
    background .2s ease,
    border-color .2s ease,
    box-shadow .2s ease,
    transform .15s ease;
}

.status-btn:hover{
  background:rgba(245,196,81,.12);
  border-color:rgba(245,196,81,.65);
  box-shadow:0 0 10px rgba(245,196,81,.35);
  transform:translateY(-1px);
}

  /* ================================
   RECENT FEED â€“ GRID LAYOUT
================================ */
.recent-feed-grid{
  display:grid;
  grid-template-columns: 1fr auto;
  gap:16px;
  align-items:start;
}

.recent-feed-left{
  min-width:0;
}

.recent-feed-right{
  display:flex;
  align-items:flex-start;
}

/* ================================
   MINI LOOT PREVIEW (2x2 GRID)
================================ */
.loot-preview-grid{
  display:grid;
  grid-template-columns: repeat(2, 44px);
  grid-auto-rows: 44px;
  gap:8px;
}

.loot-preview{
  width:44px;
  height:44px;
  border-radius:10px;
  background-color:rgba(0,0,0,.35);
  background-size:cover;
  background-position:center;
  opacity:.75;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06);
}

/* feste Loot-Typen */
.loot-weapon{
  background-image:url("img/icons/waffe.png");
}
.loot-armor{
  background-image:url("img/icons/ruestung.png");
}
.loot-jewelry{
  background-image:url("img/icons/ring.png");
}
.loot-special{
  background-image:url("img/icons/charm.png");
}

  /* ================================
   FILTER + SLOGAN FLOW
================================ */
.filter-slogan-wrap{
  margin: 18px 28px 6px;
  padding: 10px 14px 14px;
  border-radius: 18px;
  background:
    linear-gradient(
      to bottom,
      rgba(255,255,255,.04),
      rgba(255,255,255,0)
    );
}

.loot-slogan{
  text-align:center;
  font-size:14px;
  letter-spacing:.2px;
  color:#cfcfcf;
  opacity:.9;
}

/* Icon-Bar sanfter andocken */
.icon-bar{
  margin-top: 10px;
}

.icon-btn{
  background: rgba(255,255,255,.03);
  border-color: rgba(255,255,255,.08);
}

.icon-btn.active{
  background: rgba(255,215,120,.10);
}

/* ================================
   CARDS â€“ VISUAL CLEANUP (FINAL)
================================ */

/* Grid ruhiger */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(320px, 360px));
  gap:18px;
  justify-content:center;
}

/* Card-Grundstil */
.card{
  background:linear-gradient(
    to bottom,
    rgba(255,255,255,.045),
    rgba(255,255,255,.02)
  );
  border:1px solid rgba(255,255,255,.06);
  border-radius:20px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.02);
  transition:background .2s ease, border-color .2s ease;
}

/* Hover = minimal, kein Aufpoppen */
.card:hover{
  background:linear-gradient(
    to bottom,
    rgba(255,255,255,.06),
    rgba(255,255,255,.025)
  );
  border-color:rgba(255,255,255,.10);
}

/* Bild ruhig einbetten */
.card-image img{
  border-radius:14px;
  background:rgba(0,0,0,.25);
}

/* ================================
   TEXT-HIERARCHIE
================================ */

.item-name{
  font-size:17px;
  font-weight:600;
  margin-bottom:4px;
}

/* Diablo-QualitÃ¤tsfarben */
.quality-unique{
  color:#c7a44a; /* Gold */
}

.quality-set{
  color:#4cff4c; /* GrÃ¼n */
}

.quality-rare{
  color:#f0e68c; /* Gelb */
}

.quality-magic{
  color:#6fa8ff; /* Blau */
}

.quality-normal{
  color:#f0f0f0;
}

.item-sub{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.6px;
  color:#b5b5b5;
}

.item-roll{
  font-size:13px;
  color:#cfcfcf;
}

/* Spender bewusst zurÃ¼ckgenommen */
.player{
  font-size:12px;
  color:#9a9a9a;
}

  /* ================================
   ICON BAR â€“ ALL BUTTON TUNING
================================ */
.icon-btn[data-type=""]{
  background: rgba(255,255,255,.015);
  border-color: rgba(255,255,255,.06);
}

.icon-btn[data-type=""].active{
  background: rgba(255,255,255,.04);
  border-color: rgba(255,255,255,.12);
  box-shadow: none;
}

  /* ================================
   ICON BAR â†’ SEARCH SPACING
================================ */
.filter-slogan-wrap{
  margin-bottom:22px;
}

.filter-bar,
.search-bar{
  margin-top:16px;
}

  /* ================================
   VISITOR COUNTER â€“ CLEAN BADGE
================================ */
.visitor-badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 12px;
  border-radius:999px;
  background:rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.08);
  font-size:12px;
  color:#cfcfcf;
}

.visitor-icon{
  opacity:.85;
}

.visitor-label{
  color:#9a9a9a;
}

.visitor-count{
  font-weight:600;
  color:#e6e6e6;
}

  /* ================================
   VISITOR BADGE â€“ SPACING
================================ */
#visitorCounter{
  margin-top: 10px;
}

  .hero-stats{
  gap: 14px;
}

/* ================================
   AUTH BOX â€“ STACKED (VARIANTE A)
================================ */

.auth-box--stacked{
  align-items:flex-start;
}

.auth-meta{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.auth-name{
  font-size:13px;
  font-weight:600;
}

.auth-submit{
  font-size:12px;
  color:var(--gold);
  text-decoration:none;
  opacity:.9;
}

.auth-submit:hover{
  text-decoration:underline;
  opacity:1;
}

.auth-links{
  font-size:12px;
  opacity:.75;
}

.auth-links a{
  color:#eaeaea;
  text-decoration:none;
}

.auth-links a:hover{
  text-decoration:underline;
}

  /* ================================
   CARD HEADER (COLLAPSED VIEW)
================================ */

.card-header{
  all: unset;
  display: flex;
  align-items: center;
  gap: 14px;
  width: 100%;
  padding: 14px 16px;
  cursor: pointer;
}

.card-header:hover{
  background: rgba(255,255,255,.03);
}

/* Pfeil */
.card-chevron{
  font-size: 14px;
  color: #9a9a9a;
  transition: transform .25s ease;
  flex-shrink: 0;
}

/* Titel-Block */
.card-title{
  display: flex;
  flex-direction: column;
  gap: 3px;
}

/* Kategorie */
.item-category{
  font-size: 11px;
  letter-spacing: .5px;
  text-transform: uppercase;
  color: #9a9a9a;
}

/* ================================
   CARD DETAILS (EXPANDABLE)
================================ */

.card-details{
  max-height:0;
  opacity:0;
  overflow:hidden;

  display:grid;
  grid-template-columns:140px 1fr;
  gap:18px;
  align-items:center;

  transition:
    max-height .35s ease,
    opacity .25s ease;

  padding:0 16px;
}

/* OFFEN */
.card[data-open="true"] .card-details{
  max-height:800px;
  opacity:1;
  padding:16px;
}

/* Pfeil drehen */
.card[data-open="true"] .card-chevron{
  transform:rotate(90deg);
}

/* ================================
   DETAILS CONTENT
================================ */

.card-details .card-image{
  grid-column:1;
  align-self:end;
  margin-top:12px;
}

.card-details .card-image img{
  width:100%;
  max-width:200px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
}

/* Rechter Detailbereich */
.card-details .card-body{
  grid-column:2;
  display:flex;
  flex-direction:column;
  gap:10px;
  justify-content:flex-end;
  padding-bottom:6px;
}

/* Claim Row */
.card-details .claim-row{
  margin-top:8px;
}

/* ================================
   RUHIGER COLLAPSED LOOK
================================ */

/* wenn geschlossen â†’ KEIN Hover-Push */
.card[data-open="false"]:hover{
  transform: none;
  box-shadow: none;
}

/* ================================
   MOBILE FEINSCHLIFF
================================ */

@media (max-width: 900px){
  .cards{
    grid-template-columns: 1fr;
  }
}

  /* ================================
   ITEM TYPE ICON (CARD HEADER)
================================ */

.item-type-icon{
  width: 48px;
  height: 48px;
  opacity: .95;
  filter:
    drop-shadow(0 0 6px rgba(0,0,0,.85));
  flex-shrink: 0;
}

  /* ================================
   ACTIVE CARD HIGHLIGHT
================================ */

.card[data-open="true"]{
  border-color: rgba(245,196,81,.45);
  box-shadow:
    0 0 0 1px rgba(245,196,81,.25),
    0 0 22px rgba(245,196,81,.18),
    inset 0 0 12px rgba(245,196,81,.08);
}

  /* ================================
   ACTIVE CARD â€“ CHEVRON GLOW
================================ */

.card[data-open="true"] .card-chevron{
  color: #f5c451;
  text-shadow:
    0 0 6px rgba(245,196,81,.55),
    0 0 14px rgba(245,196,81,.35);
}

  /* ================================
   ACTIVE CARD â€“ LIFT EFFECT
================================ */

.card{
  transition:
    box-shadow .25s ease,
    transform .25s ease,
    border-color .25s ease;
}

.card[data-open="true"]{
  transform: translateY(-4px);
}

/* ================================
   FEED TARGET HIGHLIGHT (PULSE)
================================ */

@keyframes feedPulse {
  0% {
    box-shadow:
      0 0 0 1px rgba(245,196,81,.15),
      0 0 6px rgba(245,196,81,.15);
    border-color: rgba(245,196,81,.25);
  }
  50% {
    box-shadow:
      0 0 0 1px rgba(245,196,81,.45),
      0 0 22px rgba(245,196,81,.45);
    border-color: rgba(245,196,81,.55);
  }
  100% {
    box-shadow:
      0 0 0 1px rgba(245,196,81,.15),
      0 0 6px rgba(245,196,81,.15);
    border-color: rgba(245,196,81,.25);
  }
}

.card.feed-highlight{
  opacity: 1;
  animation: feedPulse 0.8s ease-in-out 3;
}

  /* ================================
   META BAR â€“ SUBTLE (FIXED)
================================ */

.meta-bar{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:18px;

  font-size:12px;
  color:#9a9a9a;
  opacity:.75;

  margin:6px 0 10px;
}

.meta-bar > div{
  white-space:nowrap;
}

/* â€X Items gefundenâ€œ extra ruhig */
.results-info{
  opacity:.65;
}

  .footer-visitor{
  margin-top:14px;
  font-size:11px;
  opacity:.35;
  color:#aaa;
  text-align:center;
  user-select:none;
}

.footer-visitor:hover{
  opacity:.65;
}

  #playerAvatar{
  width:40px;
  height:40px;
  border-radius:50%;
  object-fit:cover;          /* WICHTIG: beschneiden statt skalieren */
  object-position:50% 50%;   /* Default-Zentrum */
  background:#000;
  border:1px solid rgba(255,255,255,.18);
}

/* =========================
   DONOR / SPENDER (CARD)
========================== */
.donor-block{
  display:flex;
  flex-direction:column;
  gap:2px;
  margin-top:6px;
}

.donor-label{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.04em;
  color:#9a9a9a;
}

.donor-name{
  font-size:14px;
  font-weight:600;
  color:#e6c36a;
  text-decoration:none;
}

.donor-name:hover{
  text-decoration:underline;
  color:#ffd77a;
}

.donor-line{
  display:flex;
  align-items:center;
  gap:6px;
}

.donor-class-icon{
  width:16px !important;
  height:16px !important;
  min-width:16px;
  min-height:16px;

  display:inline-block !important;
  object-fit:cover;

  border-radius:3px;
  opacity:0.85;
  filter:drop-shadow(0 0 4px rgba(0,0,0,.6));
}
  
</style>
</head>

<body>
<div class="wrapper">

<!-- ================================
     HERO
================================ -->
<header class="hero">
  <div class="hero-inner">

    <div class="auth-box auth-box--stacked">
      <img
  id="playerAvatar"
  src="img/avatars/default.png"
  alt="Avatar"
  width="32"
  height="32"
/>

      <div class="auth-meta">
        <span
          class="auth-name"
          id="playerIdLabel"
          data-placeholder="Spieler lÃ¤dtâ€¦"
        ></span>

<!-- INFO: eigenes Item wurde reserviert (klickbar) -->
<a
  id="ownerReservedInfo"
  href="my-items.html?status=reserviert"
  style="
    display:none;
    margin:8px 0 10px;
    padding:6px 10px;
    font-size:12px;
    line-height:1.3;
    color:#f5c451;
    background:rgba(245,196,81,.06);
    border:1px solid rgba(245,196,81,.25);
    border-radius:10px;
    text-decoration:none;
    cursor:pointer;
  "
>
  ğŸ”” Ein Item von dir ist reserviert
</a>

<a href="submit.html" class="auth-submit">
  + Item einreichen
</a>

<div class="auth-links">
  <span class="auth-account-links">
 <a href="my-profile.html">Profil</a>
    <span>Â·</span>
    <a href="my-items.html">Meine Items</a>
    <span>Â·</span>
    <a href="my-claims.html">Meine Claims</a>
    <span>Â·</span>
    <a href="archive.html">Archiv</a>
  </span>

          <span class="auth-login-sep" hidden>Â·</span>
          <a href="auth.html" class="auth-login" hidden>
            Einloggen / Registrieren
          </a>
        </div>

        <button class="auth-logout" hidden>Logout</button>
      </div>
    </div>

    <h1 class="hero-logo">
      <img src="img/logo_d2r.png" alt="D2R Lootliste Logo">
    </h1>

    <p>Community Lootliste Â· Diablo II Resurrected</p>

    <div class="mode-banner">
      Aktueller Modus: <strong>NON-LADDER</strong>
      <span>Â· Ladder in Vorbereitung</span>
    </div>

    <div class="hero-stats">
      <div class="hero-stat">
        ğŸ“¦ <strong id="heroItemCount">3</strong> Drops
      </div>

      <div class="hero-stat">
        ğŸŸ¢ <strong>Community-Betrieb</strong>
      </div>

      <div class="hero-stat">
        ğŸ§™ <strong id="heroDonorCount">3</strong> Spieler
      </div>
    </div>

  </div>
</header>
  
<!-- ================================
     PROJECT STATUS (FINAL)
================================ -->
<section class="project-status">

  <div class="status-line">
    <span class="status-dot"></span>
    <span class="status-text">
      Projektstatus: <strong>Phase 1 Â· Community-Test</strong>
    </span>
  </div>

  <div class="status-note">
    FrÃ¼he Ã¶ffentliche Phase Â· Kernfunktionen aktiv Â· Feedback willkommen
  </div>

  <div class="status-actions">
    <a href="feedback.html" class="status-btn">
      Feedback / Bug melden
    </a>
  </div>

</section>

<!-- ================================
     RECENT ITEMS FEED
================================ -->
<section class="recent-feed recent-feed">

  <div class="recent-feed-left">
    <div class="recent-feed-title">
      Aktuelle EintrÃ¤ge
    </div>

    <ul class="recent-feed-list" id="recentFeed">
      <!-- JS fÃ¼llt hier Items -->
    </ul>
  </div>

</section>

<!-- ================================
     ICON BAR
================================ -->
<nav class="icon-bar">

  <div class="icon-btn" data-type="waffe">
    <img src="img/icons/waffe.png" alt="Waffe">
    <span>Waffe</span>
  </div>

  <div class="icon-btn" data-type="helm">
    <img src="img/icons/helm.png" alt="Helm">
    <span>Helm</span>
  </div>

  <div class="icon-btn" data-type="ruestung">
    <img src="img/icons/ruestung.png" alt="RÃ¼stung">
    <span>RÃ¼stung</span>
  </div>

  <div class="icon-btn" data-type="schild">
    <img src="img/icons/schild.png" alt="Schild">
    <span>Schild</span>
  </div>

  <div class="icon-btn" data-type="guertel">
    <img src="img/icons/guertel.png" alt="GÃ¼rtel">
    <span>GÃ¼rtel</span>
  </div>

  <div class="icon-btn" data-type="handschuhe">
    <img src="img/icons/handschuhe.png" alt="Handschuhe">
    <span>Handschuhe</span>
  </div>

  <div class="icon-btn" data-type="schuhe">
    <img src="img/icons/schuhe.png" alt="Schuhe">
    <span>Schuhe</span>
  </div>

  <div class="icon-btn" data-type="amulett">
    <img src="img/icons/amulett.png" alt="Amulett">
    <span>Amulett</span>
  </div>

  <div class="icon-btn" data-type="ring">
    <img src="img/icons/ring.png" alt="Ring">
    <span>Ring</span>
  </div>

  <div class="icon-btn" data-type="charm">
    <img src="img/icons/charm.png" alt="Charm">
    <span>Charm</span>
  </div>

  <div class="icon-btn" data-type="rune">
    <img src="img/icons/rune.png" alt="Rune">
    <span>Rune</span>
  </div>

  <div class="icon-btn" data-type="sonstiges">
    <img src="img/icons/sonstiges.png" alt="Sonstiges">
    <span>Sonstiges</span>
  </div>

</nav>

<!-- ================================
     SLOGAN
================================ -->
<div class="filter-slogan-wrap">
  <div class="loot-slogan">
    ğŸ©¸ â€” ğŸ—¡ï¸ Kein Kampf.   Kein Blut.   Nur Loot. ğŸ—¡ï¸ â€” ğŸ©¸
  </div>
</div>


<!-- ================================
     CONTENT
================================ -->
<div class="container">

  <!-- META / RESULTS -->
  <div class="meta-bar">

    <div class="meta-left">
      ğŸ“¦ <strong id="metaItemCount">0</strong> Items
    </div>

    <div class="meta-right">
      ğŸ•’ Stand: <span id="metaDate">â€“</span>
    </div>

    <div id="resultsInfo" class="results-info">
      <span id="resultsCount">0</span> Items gefunden
    </div>

  </div>

  <!-- FILTER -->
  <div class="filter-panel">
    <div class="filter-row">

      <input
        type="text"
        id="filterSearch"
        placeholder="Item suchen â€¦"
        autocomplete="off"
      >

      <select id="filterSort">
        <option value="rating-desc">Rating â†“</option>
        <option value="rating-asc">Rating â†‘</option>
        <option value="name-asc">Name Aâ€“Z</option>
        <option value="name-desc">Name Zâ€“A</option>
      </select>

    </div>
  </div>

</div>

<!-- ================================
     CARDS
================================ -->
<section class="cards">

  <!-- SKELETON LOADING -->
  <div id="skeletons" class="skeletons">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
  </div>

  <!-- EMPTY STATE -->
  <div id="emptyState" class="empty-state" hidden>
    Keine Items gefunden.
  </div>

</section>

</div>
  
<!-- ================================
     FOOTER
================================ -->
<footer class="footer">

  <div class="footer-links">
    <a href="ueber-das-projekt.html">Ãœber das Projekt</a>
    <span>Â·</span>
    <a href="entwickler.html">Ãœber den Entwickler</a>
    <span>Â·</span>
    <a href="pages/cube.html">Horadrim-WÃ¼rfel (Cube Codex)</a>
    <span>Â·</span>
    <a href="impressum.html">Impressum</a>
    <span>Â·</span>
    <a href="datenschutz.html">Datenschutz</a>
    <span>Â·</span>
    <a href="https://www.instagram.com/d2r.lootliste"
       target="_blank"
       rel="noopener">
      Instagram
    </a>
  </div>

  <div class="footer-meta">
    <span>Community-Projekt</span>
    <span>Â·</span>
    <span>Diablo II: Resurrected</span>
    <span>Â·</span>
    <span><strong>Non-Ladder</strong></span>
  </div>

  <div class="footer-visitor">
  ğŸ‘ï¸ <span class="visitor-count">â€“</span>
</div>

</footer>

<!-- ================================
     FAKE: SCREENSHOT_OVERLAY
================================ -->
<div id="screenshotOverlay" class="overlay" hidden>

  <div class="overlay-backdrop"></div>

  <div class="overlay-content">
    <img
      id="overlayImage"
      src=""
      alt="Screenshot Vorschau"
    >
  </div>

</div>

</div>

  <script>
/* ===== SCREENSHOT OVERLAY (CLICK TO OPEN) ===== */
(function () {
  const overlay   = document.getElementById("screenshotOverlay");
  const imgTarget = document.getElementById("overlayImage");
  if (!overlay || !imgTarget) return;

  // Ã–ffnen: Klick auf Card-Image
  document.addEventListener("click", (e) => {
    const img = e.target.closest(".card-image img");
    if (!img) return;

    // Quelle bestimmen:
    // 1) data-full (falls spÃ¤ter vorhanden)
    // 2) src des Icons (Fallback)
    const fullSrc = img.dataset.full || img.src;
    imgTarget.src = fullSrc;

    overlay.hidden = false;
  });

  // SchlieÃŸen: Klick auf Backdrop oder ESC
  overlay.addEventListener("click", (e) => {
    if (e.target.classList.contains("overlay-backdrop")) {
      close();
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });

  function close(){
    overlay.hidden = true;
    imgTarget.src = "";
  }
})();
</script>

<script type="module">
  import { renderCards } from "./render.cards.js";

  /* ===============================
     STEP 3 â€“ Klassen â†’ Avatar-Bilder
  =============================== */
  const CLASS_AVATARS = {
    amazon: "img/classes/amazon.png",
    assassin: "img/classes/assassin.png",
    barbarian: "img/classes/barbarian.png",
    druid: "img/classes/druid.png",
    necromancer: "img/classes/necromancer.png",
    paladin: "img/classes/paladin.png",
    sorceress: "img/classes/sorceress.png"
  };

  /* ===============================
     STEP 4 â€“ Klassen â†’ Bild-Ausschnitt
     (object-position)
  =============================== */
  const CLASS_AVATAR_CROP = {
    amazon: "50% 25%",
    assassin: "50% 22%",
    barbarian: "50% 28%",
    druid: "50% 20%",
    necromancer: "50% 22%",
    paladin: "50% 24%",
    sorceress: "50% 18%"
  };

  /* ===============================
   DEBUG â€“ Klasse live wechseln
=============================== */
window.setDebugClass = function (cls) {
  localStorage.setItem("lootliste_debug_class", cls);
  setUserLabel(); // Avatar & Name sofort neu setzen
};

  // ===============================
  // SEASON (ZENTRAL)
  // ===============================
  const ACTIVE_SEASON = "non-ladder";

  // ğŸ”Œ API (WICHTIG: Modul-Scope!)
  const API = "https://lootliste-production.up.railway.app";

  const currentAccountId =
    localStorage.getItem("lootliste_account_id") || null;

  // ğŸ”” Check: Wurde eines meiner Items reserviert?
  async function checkOwnerReservedItems() {
    const accountId = localStorage.getItem("lootliste_account_id");
    if (!accountId) return;

    try {
      const res = await fetch(API + "/items?mine=1", {
        headers: { "X-Account-Id": accountId }
      });

      if (!res.ok) return;

      const items = await res.json();

      const reserved = items.filter(i =>
        i.status === "reserviert" &&
        i.donorAccountId === accountId
      );

      if (reserved.length > 0) {
        const info = document.getElementById("ownerReservedInfo");
        if (info) {
          if (reserved.length === 1) {
            info.href = `my-items.html#item-${reserved[0].id}`;
            info.textContent = "ğŸ”” Ein Item von dir ist reserviert";
          } else {
            info.href = "my-items.html";
            info.textContent = "ğŸ”” Items von dir sind reserviert";
          }
          info.style.display = "block";
        }
      }

    } catch {
      // still & leise scheitern
    }
  }

// DOM
const container = document.querySelector(".cards");
const skeletons = document.getElementById("skeletons");

// Meta / Hero
const metaCount = document.getElementById("metaItemCount");
const metaDate  = document.getElementById("metaDate");
const heroCount = document.getElementById("heroItemCount");
const heroAvg   = document.getElementById("heroAvgRating");
const heroDonor = document.getElementById("heroDonorCount");

// Results / Empty
const resultsInfo  = document.getElementById("resultsInfo");
const resultsCount = document.getElementById("resultsCount");
const emptyState   = document.getElementById("emptyState");

// State
const state = {
  items: [],
  filtered: [],
  type: "",
  search: "",
  sort: "rating-desc"
};

async function loadItems() {
  const res = await fetch(API + "/items", {
    headers: {
      "X-User-Id": localStorage.getItem("lootliste_user_id") || "",
      "X-Account-Id": localStorage.getItem("lootliste_account_id") || ""
    }
  });

  // ğŸ” Device-ID aus Header ODER LocalStorage setzen
  const headerUid = res.headers.get("X-User-Id");
  if (headerUid) {
    localStorage.setItem("lootliste_user_id", headerUid);
  }

const data = await res.json();

// ğŸ”’ Ã–ffentliche Liste:
// nur verfÃ¼gbare Items DER AKTIVEN SEASON
state.items = data
  .filter(i =>
    i.status === "verfÃ¼gbar" &&
    (i.season ?? "non-ladder") === ACTIVE_SEASON
  )
  .map(item => ({
    ...item,
    isOwner:
      currentAccountId &&
      item.donorAccountId === currentAccountId
  }));

state.filtered = [...state.items];

// Username laden
await setUserLabel();

// ğŸ†• Recent Items Feed
renderRecentFeed(state.items);
}

  // ===============================
// RECENT ITEMS FEED (MINIMAL)
// ===============================
function renderRecentFeed(items){
  const feed = document.getElementById("recentFeed");
  if (!feed) return;

  const list = items
    .filter(i => i.createdAt)
    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
    .slice(0, 3);

  if (list.length === 0) {
    feed.parentElement.style.display = "none";
    return;
  }

  feed.innerHTML = "";

  list.forEach(item => {
    const li = document.createElement("li");
    li.className = "recent-feed-item";

    // + / - Logik (vorbereitet)
    const action = "â•"; // spÃ¤ter: âŒ bei entfernt / vergeben

    // Item-Typ â†’ Icon
    const type = (item.type || item.category || "sonstiges").toLowerCase();
    const iconUrl = `img/icons/${type}.png`;

    li.innerHTML = `
      <span class="recent-feed-icon" style="background-image:url('${iconUrl}')"></span>
      <span>${action}</span>
      <span>
        ${item.donor || "Ein Spieler"} hat
        <a href="#item-${item.id}">${item.name}</a>
        hinzugefÃ¼gt Â· ${timeAgo(item.createdAt)}
      </span>
    `;

    feed.appendChild(li);
  });
}

// ğŸ‘¤ Anzeige: Username (falls Account) â†’ sonst Gast
async function setUserLabel() {
  const label = document.getElementById("playerIdLabel");
  const submitLink = document.querySelector(".auth-submit");
  const logoutBtn = document.querySelector(".auth-logout");
  const loginLink = document.querySelector(".auth-login");
  const loginSep  = document.querySelector(".auth-login-sep");
  const accountLinks = document.querySelector(".auth-account-links");
  const avatar = document.getElementById("playerAvatar");

  if (!label) return;

  const deviceId  = localStorage.getItem("lootliste_user_id");
  const accountId = localStorage.getItem("lootliste_account_id");

  // Default: alles aus
  label.textContent = label.dataset.placeholder || "Spieler lÃ¤dtâ€¦";
  if (submitLink) submitLink.style.display = "none";
  if (logoutBtn) logoutBtn.hidden = true;
  if (loginLink) loginLink.hidden = true;
  if (loginSep)  loginSep.hidden  = true;
  if (accountLinks) accountLinks.hidden = true;

  // Default Avatar
  if (avatar) {
    avatar.src = "img/avatars/default.png";
    avatar.style.objectPosition = "50% 50%";
  }

  const headers = {};
  if (deviceId)  headers["X-User-Id"] = deviceId;
  if (accountId) headers["X-Account-Id"] = accountId;

  try {
    const res = await fetch(API + "/me", { headers });
    const data = await res.json();

    if (data.username) {
      // âœ… Eingeloggt
      label.textContent = data.username;
      if (submitLink) submitLink.style.display = "";
      if (logoutBtn) logoutBtn.hidden = false;
      if (accountLinks) accountLinks.hidden = false;

      // ğŸ­ Klassen-Avatar (Backend ODER Debug)
const profileData = JSON.parse(localStorage.getItem("my_profile") || "{}");

const effectiveClass =
  data.class ||
  localStorage.getItem("lootliste_debug_class") ||
  profileData.favClass?.toLowerCase();

      if (
        avatar &&
        effectiveClass &&
        CLASS_AVATARS[effectiveClass]
      ) {
        avatar.src = CLASS_AVATARS[effectiveClass];
        avatar.style.objectPosition =
          CLASS_AVATAR_CROP[effectiveClass] || "50% 50%";
      }

      checkOwnerReservedItems();

    } else {
      // ğŸ‘¤ Gast
      label.textContent = "Gast";
      if (loginLink) loginLink.hidden = false;
      if (loginSep)  loginSep.hidden  = false;
    }

  } catch {
    // ğŸ‘¤ Fehler = Gast
    label.textContent = "Gast";
    if (loginLink) loginLink.hidden = false;
    if (loginSep)  loginSep.hidden  = false;
  }
}

// ğŸ”§ Dev / Debug: im Browser nutzbar machen (Module-Scope!)
window.setUserLabel = setUserLabel;

function updateMeta() {
  const list = state.filtered;

  // Counts
  metaCount && (metaCount.textContent = list.length);
  heroCount && (heroCount.textContent = list.length);

  // Avg rating
  if (heroAvg) {
    const ratings = list.map(i => i.rating).filter(Boolean);
    heroAvg.textContent = ratings.length
      ? (ratings.reduce((a,b)=>a+b,0) / ratings.length).toFixed(1)
      : "â€“";
  }

  // Unique donors
  if (heroDonor) {
    const donors = new Set(list.map(i => i.donor).filter(Boolean));
    heroDonor.textContent = donors.size;
  }

  // Date
  metaDate && (metaDate.textContent =
    new Date().toLocaleDateString("de-DE")
  );
}

  function updateResultsUI() {
    const count = state.filtered.length;

    // Results info
    if (resultsInfo && resultsCount) {
      resultsCount.textContent = count;
      resultsInfo.style.display = count === 0 ? "none" : "";
    }

    // Empty state
    if (emptyState) {
      emptyState.hidden = count !== 0;
    }
  }

function applyFilters() {
  let list = [...state.items];

// Type (robust: type first, fallback category)
if (state.type) {
  list = list.filter(i => {
    const t = (i.type || i.category || "").toLowerCase();
    return t === state.type;
  });
}

  // Search
  if (state.search) {
    const q = state.search.toLowerCase();
    list = list.filter(i => (i.name || "").toLowerCase().includes(q));
  }

  // Sort
  if (state.sort === "rating-desc") {
    list.sort((a, b) => (b.rating || 0) - (a.rating || 0));
  }

  if (state.sort === "rating-asc") {
    list.sort((a, b) => (a.rating || 0) - (b.rating || 0));
  }

  state.filtered = list;
  renderCards(state.filtered, container);
  updateMeta();
  updateResultsUI();
}

  // Initial render
setTimeout(async () => {
  skeletons?.remove();
  await loadItems();
  applyFilters();
}, 400);

  // Search
  const searchInput = document.getElementById("filterSearch");
  searchInput?.addEventListener("input", () => {
    state.search = searchInput.value;
    applyFilters();
  });

  // Sort
  const sortSelect = document.getElementById("filterSort");
  sortSelect?.addEventListener("change", () => {
    state.sort = sortSelect.value;
    applyFilters();
  });

  // Icon bar
  const iconBar = document.querySelector(".icon-bar");
  iconBar?.addEventListener("click", e => {
    const btn = e.target.closest(".icon-btn");
    if (!btn) return;

    const type = btn.dataset.type || "";

    iconBar.querySelectorAll(".icon-btn")
      .forEach(b => b.classList.remove("active"));

    state.type = state.type === type ? "" : type;
    if (state.type) btn.classList.add("active");

    applyFilters();
  });

  // ğŸ”“ Logout (minimal, wie im Admin)
document.addEventListener("click", (e) => {
  if (!e.target.classList.contains("auth-logout")) return;

  localStorage.removeItem("lootliste_account_id");
  localStorage.removeItem("lootliste_user_id");

  location.reload();
});

  function timeAgo(date){
  const seconds = Math.floor((Date.now() - new Date(date)) / 1000);

  if (seconds < 60) return "gerade eben";
  const minutes = Math.floor(seconds / 60);
  if (minutes < 60) return `vor ${minutes} Min`;
  const hours = Math.floor(minutes / 60);
  if (hours < 24) return `vor ${hours} Std`;
  const days = Math.floor(hours / 24);
  return `vor ${days} Tag${days > 1 ? "en" : ""}`;
}

  // ===============================
// FEED TARGET HIGHLIGHT (NO OPEN)
// ===============================
window.addEventListener("hashchange", highlightFromHash);
window.addEventListener("load", highlightFromHash);

function highlightFromHash(){
  if (!location.hash.startsWith("#item-")) return;

  const el = document.querySelector(location.hash);
  if (!el) return;

  el.classList.add("feed-highlight");

  setTimeout(() => {
    el.classList.remove("feed-highlight");
  }, 1600);
}

</script>

  <script>
function showToast(text){
  const t = document.getElementById("toast");
  if (!t) return;

  t.textContent = text;
  t.hidden = false;

  setTimeout(() => {
    t.hidden = true;
  }, 2200);
}
</script>

<script>
(function () {
  const counterEl = document.querySelector(".visitor-count");
  if (!counterEl) return;

  const deviceId = localStorage.getItem("lootliste_user_id");

  fetch("https://lootliste-production.up.railway.app/visit", {
    method: "POST",
    headers: deviceId
      ? { "X-User-Id": deviceId }
      : {}
  })
    .then(res => {
      // Backend kann eine neue Device-ID setzen
      const newId = res.headers.get("X-User-Id");
      if (newId) {
        localStorage.setItem("lootliste_user_id", newId);
      }
      return res.json();
    })
    .then(data => {
      if (typeof data.count === "number") {
        counterEl.textContent = data.count;
      }
    })
    .catch(() => {
      // Fallback â†’ alte Zahl bleibt stehen
    });
})();
</script>

  <div id="toast" class="toast" hidden></div>
  
</body>
</html>
