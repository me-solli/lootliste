<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title> Free Lootliste ‚Äì Community Items | D2R Non-Ladder (v2.1)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --gold:#f5c451;
  --bg:#0b0b0b;
  --panel:#121212;
  --border:#2a2a2a;
  --soft:#1a1a1a;
  --green:#4cff4c;
  --yellow:#ffd24c;
  --red:#ff5c5c;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(ellipse at top,#181818 0%,#090909 65%);
  color:#eaeaea;
}

.wrapper{max-width:1500px;margin:0 auto}

/* ===== HERO ===== */
.hero{
  background:url("img/banner_diablo.png") center top / cover no-repeat;
  border-radius:0 0 26px 26px;
  overflow:hidden;
  min-height:260px;
}

.hero-inner{
  padding:44px 36px;
  background:linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.85));
}

.hero h1{margin:0;font-size:42px;letter-spacing:1px}
.hero h1 span{color:var(--gold)}
.hero p{margin:10px 0 18px;opacity:.9}

.hero-stats{
  display:flex;
  gap:18px;
  flex-wrap:wrap;
  font-size:14px;
}

.hero-stats div{
  padding:8px 14px;
  background:rgba(0,0,0,.4);
  border:1px solid var(--border);
  border-radius:999px;
}

.hero-right{
  margin-top:18px;
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}

.twitch{
  background:#9146FF;
  color:#fff;
  padding:12px 18px;
  border-radius:14px;
  font-weight:bold;
  text-decoration:none;
}
.twitch:hover{opacity:.85}

#visitorCounter{font-size:13px;opacity:.85}

  /* ===== RULES BAR ===== */
.rules-bar{
  display:flex;
  justify-content:flex-end;
  padding:8px 28px 6px;
  font-size:13px;
  background:linear-gradient(
    180deg,
    rgba(0,0,0,.35),
    rgba(0,0,0,0)
  );
  border-bottom:1px solid #1f1f1f;
}

.rules-bar a{
  color:#bfa86a;
  opacity:.75;
  text-decoration:none;
}

.rules-bar a:hover{
  opacity:1;
  text-decoration:underline;
}
  
/* ===== ICON BAR ===== */
.icon-bar{
  display:flex;
  gap:14px;
  padding:20px 24px;
  overflow-x:auto;
  background:linear-gradient(180deg,#141414,#0d0d0d);
  border-bottom:1px solid #222;
}

.icon-btn{
  min-width:96px;
  text-align:center;
  cursor:pointer;
  padding:12px 6px;
  border-radius:16px;
  border:1px solid transparent;
  transition:.25s;
}

.icon-btn img{
  width:42px;
  height:42px;
  filter:drop-shadow(0 0 8px rgba(245,196,81,.35));
}

.icon-btn span{
  display:block;
  margin-top:6px;
  font-size:12px;
  font-weight:500;
  letter-spacing:.3px;
  opacity:.9;
}

.icon-btn:hover{
  border-color:var(--gold);
  box-shadow:0 0 18px rgba(245,196,81,.25);
}

.icon-btn.active{
  border-color:var(--gold);
  background:rgba(245,196,81,.08);
  box-shadow:0 0 22px rgba(245,196,81,.45);
}

/* ===== CONTENT ===== */
.container{padding:30px}

/* ===== META BAR ===== */
.meta-bar{
  display:flex;
  gap:18px;
  flex-wrap:wrap;
  margin-bottom:18px;
  font-size:13px;
  opacity:.9;
}

/* ===== FILTER ===== */
.filter-panel{
  background:linear-gradient(180deg,#171717,#0f0f0f);
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:18px;
}

.filter-panel input,
.filter-panel select{
  padding:10px 12px;
  background:#111;
  border:1px solid #333;
  color:#fff;
  border-radius:10px;
}

/* ===== REQUEST FEED ===== */
.request-feed{
  background:linear-gradient(180deg,#171717,#0f0f0f);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  margin-bottom:22px;
}

.request-feed h3{
  margin:0 0 10px;
  font-size:15px;
  color:var(--gold);
}

.request-entry{
  font-size:13px;
  padding:6px 0;
  border-bottom:1px solid #222;
  opacity:.9;
}
.request-entry:last-child{border-bottom:none}

/* ===== CARDS ===== */
.cards{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:22px;
}

@media(max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}}
@media(max-width:650px){.cards{grid-template-columns:1fr}}

.card{
  display:flex;
  background:linear-gradient(180deg,#191919,#0f0f0f);
  border:1px solid var(--border);
  border-radius:20px;
  overflow:hidden;
  transition:.25s;
  position:relative;
}
  
/* ================================
   DIABLO ITEM STATUS ‚Äì METALL RAND
   ================================ */

.card{
  border-left:3px solid #2a2a2a; /* neutral */
}

/* Verf√ºgbar ‚Üí moosig, ents√§ttigt */
.card.verfuegbar{
  border-left-color:#6f7f4a;
}

/* Reserviert ‚Üí dunkles Bernstein */
.card.reserviert{
  border-left-color:#8a6a3a;
}

/* Vergeben ‚Üí dunkles Rotbraun */
.card.vergeben{
  border-left-color:#5a2e2e;
  opacity:.85;
}

/* ===== STATUS BADGE (V3 FINAL) ===== */
.status-badge{
  position:absolute;
  top:12px;
  right:12px;
  font-size:11px;
  padding:4px 10px;
  border-radius:999px;
  font-weight:600;

  background:rgba(0,0,0,.55);
  border:1px solid #2a2a2a;
  color:#ddd;

  text-transform:uppercase;
  letter-spacing:.4px;
}

.status-badge.verfuegbar{
  border-color:#6f7f4a;
  color:#e6edd0;
}

.status-badge.reserviert{
  border-color:#8a6a3a;
  color:#f0e3c2;
}

.status-badge.vergeben{
  border-color:#5a2e2e;
  color:#e8cfcf;
}

.status-badge.reserviert{
  background:linear-gradient(
    180deg,
    rgba(255,210,120,.45),
    rgba(138,106,58,.22)
  );
  color:#fff1d2;
  border:1px solid #caa24a;
}

.status-badge.vergeben{
  background:linear-gradient(
    180deg,
    rgba(255,120,120,.45),
    rgba(90,46,46,.22)
  );
  color:#ffdede;
  border:1px solid #b85a5a;
}

  /* ===== CARD HOVER (V3) ===== */
.card:hover{
  transform:translateY(-4px);
  box-shadow:
    0 12px 28px rgba(0,0,0,.65),
    inset 0 0 0 1px rgba(255,255,255,.04);
}
  
  .card.vergeben:hover{
  transform:none;
  box-shadow:none;
}
  
@keyframes highlightPulse {
  0% {
    box-shadow:
      0 0 0 1px rgba(245,196,81,.35),
      0 0 10px rgba(245,196,81,.2);
  }
  50% {
    box-shadow:
      0 0 0 2px rgba(245,196,81,.85),
      0 0 26px rgba(245,196,81,.65);
  }
  100% {
    box-shadow:
      0 0 0 1px rgba(245,196,81,.35),
      0 0 10px rgba(245,196,81,.2);
  }
}

.card.highlight{
  animation: highlightPulse 1.4s ease-in-out 2;
}

.card-image{
  width:120px;
  background:radial-gradient(circle at top,#1f1f1f,#0b0b0b);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}
  
.card-image img{
  width:72px;
  height:72px;
  object-fit:contain;
  filter:drop-shadow(0 0 10px rgba(245,196,81,.35));
} 
  .card-image{
  cursor:pointer;
}
  .card-image[data-screenshot] {
  cursor: zoom-in;
}

.card-image:hover{
  box-shadow:inset 0 0 0 1px rgba(245,196,81,.35);
}
  
.card-body{
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:6px;
  flex:1;
}
  
/* Qualit√§tsfarben */
.item-name.unique{color:#c7a44b;}   /* Unique */
.item-name.set{color:#2ecc71;}      /* Set */
.item-name.rare{color:#f1c40f;}     /* Rare */
.item-name.magic{color:#4aa3ff;}    /* Magic */

  .item-name{
  font-size:16px;
  font-weight:600;
  }
  
.item-sub{
  font-size:11px;
  color:#8a8a8a;
  margin-top:4px;
  letter-spacing:.6px;
  text-transform:uppercase;
  font-weight:500;
}

.category{font-size:12px;opacity:.7}
  
.stars{
  color:var(--gold);
  font-size:16px;       /* +2px reicht v√∂llig */
  font-weight:600;      /* etwas mehr Pr√§senz */
  letter-spacing:1px;   /* hilft beim Z√§hlen */
}

.stars-filled{
  color:var(--gold);
}

.stars-empty{
  color:#555;
}

.stars-num{
  margin-left:6px;
  font-size:11px;
  color:#9a9a9a;
  font-weight:400;
}
  
  .stars-sep{
  margin:0 6px;
  color:#666;
  font-size:13px;
  opacity:.6;
}

.player{font-size:13px;opacity:.85}
.player a{color:var(--gold);text-decoration:none}

.cta{
  margin-top:8px;
  padding:9px;
  text-align:center;
  font-size:13px;
  background:#151515;
  border:1px solid var(--border);
  border-radius:12px;
  color:#fff;
  cursor:pointer;
}
.cta:hover{border-color:var(--gold);color:var(--gold)}

/* ===== REQUEST BUTTON ===== */
.request-btn{
  width:100%;
  margin-top:6px;
  padding:6px 10px;

  background:linear-gradient(#2a2218,#1a140c);
  border:1px solid #3a2f1f;
  border-radius:10px;

  color:#e6d7b3;
  font-size:12px;
  font-weight:500;
  cursor:pointer;
}
  
  .request-btn.disabled{
  opacity:.6;
  cursor:default;
}
  
.request-btn:not(.disabled):hover{
  background:linear-gradient(#2f2618,#1d170e);
  color:#f0e3c2;
  border-color:#6f7f4a;
}

.request-btn.disabled{
  opacity:.6;
  cursor:default;
}
    
  /* ===============================
   V3 CTA ‚Äì visuell beruhigt
   =============================== */

/* CTA standardm√§√üig verborgen */
.card .request-btn{
  opacity:0;
  pointer-events:none;
  transform:translateY(4px);
  transition:opacity .2s ease, transform .2s ease;
}
  /* CTA erscheint nur bei bewusster Interaktion */
.card:hover .request-btn{
  opacity:1;
  pointer-events:auto;
  transform:translateY(0);
}

  /* ===== MODAL ===== */
#requestModal{display:none}

#requestModal .backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  z-index:100;
}

#requestModal .modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#121212;
  border:1px solid var(--border);
  border-radius:18px;
  padding:22px;
  width:90%;
  max-width:420px;
  z-index:101;
  display:flex;
  flex-direction:column;
  gap:10px;
}

#requestModal input,
#requestModal textarea{
  padding:10px;
  background:#111;
  border:1px solid #333;
  border-radius:10px;
  color:#fff;
}

.modal-actions{
  display:flex;
  gap:10px;
}

.modal-actions button{
  flex:1;
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#151515;
  color:#fff;
  cursor:pointer;
}

.modal-actions button:hover{
  border-color:var(--gold);
  color:var(--gold);
}

footer{
  margin-top:50px;
  padding:22px;
  border-top:1px solid #222;
  font-size:13px;
}
footer a{color:var(--gold);margin-right:18px;text-decoration:none}



/* ===== AUTH BOX ===== */
.hero{ position:relative; }

.auth-box{
  position:absolute;
  top:22px;
  right:24px;
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px 14px;
  border:1px solid var(--border);
  border-radius:14px;
  background:rgba(0,0,0,.55);
  font-size:13px;
  z-index:5;
}
.auth-box button{
  padding:6px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#151515;
  color:#fff;
  cursor:pointer;
}
.auth-box button:hover{
  border-color:var(--gold);
  color:var(--gold);
}


/* ===== AUTH MODAL ===== */
.auth-modal{
  max-width:360px;
}
#authModal .backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  z-index:200;
}
#authModal .modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#121212;
  border:1px solid var(--border);
  border-radius:18px;
  padding:22px;
  width:90%;
  z-index:201;
  display:flex;
  flex-direction:column;
  gap:10px;
}



.hero-logo img{
  max-width:420px;
  width:100%;
  height:auto;
  filter:brightness(0.82) contrast(1.05) drop-shadow(0 0 10px rgba(0,0,0,.6));
}


/* ===== RATING HINT & ICON ===== */
.rating-hint{
  margin:14px 0 10px;
  font-size:13px;
  opacity:.8;
}
.rating-info-icon{
  margin-left:6px;
  cursor:help;
  font-size:13px;
  opacity:.8;
}














/* ===== FOOTER GOLD LINKS FIX ===== */





.footer{
  text-align:center;
  font-size:12px;
  color:#888;
  padding:24px 0;
  border-top:1px solid #222;
}

.footer-links{
  margin-bottom:6px;
}

.footer-links a{
  color:var(--gold, #d4af37);
  text-decoration:none;
}

.footer-links a:hover{
  text-decoration:underline;
}

.footer-links span{
  color:var(--gold, #d4af37);
}

.footer-copy{
  font-size:11px;
  opacity:0.7;
}


/* ===== FOOTER SEPARATOR FIX ===== */
.footer-links{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
}

.footer-links .sep{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:12px;
  transform: translateY(-1px);
}
  
  /* ===== PROJECT TIMELINE (INDEX) ===== */
.project-timeline{
  margin:22px 28px 10px;
  position:relative;
}

.timeline-track{
  position:relative;
  height:1px;              /* d√ºnner */
  background:#242424;      /* dunkler */
  border-radius:2px;
}

.timeline-progress{
  position:absolute;
  left:0;
  top:0;
  height:100%;
  width:75%;              /* bis V3 */
  background:#4f5a36;     /* ents√§ttigt, ruhiger */
  opacity:.6;             /* ~50 % Pr√§senz */
}

.timeline-steps{
  display:flex;
  justify-content:space-between;
  margin-top:-8px;
}

.timeline-step{
  position:relative;
  width:10px;
  height:10px;
  border-radius:50%;
  background:#333;
  border:1px solid #2a2a2a;
  cursor:default;
}

.timeline-step span{
  position:absolute;
  top:22px;
  left:50%;
  transform:translateX(-50%);
  font-size:11px;
  opacity:.65;
  white-space:nowrap;
}

/* Zust√§nde */
.timeline-step.done{
  background:#bfa86a;
  box-shadow:0 0 8px rgba(191,168,106,.6);
}

.timeline-step.current{
  background:#6f7f4a;
  box-shadow:0 0 14px rgba(245,196,81,.85);
}

.timeline-step.future{
  background:#333;
  opacity:.6;
}

/* Tooltip */
.timeline-step::after{
  content:attr(data-tip);
  position:absolute;
  bottom:28px;
  left:50%;
  transform:translateX(-50%);
  background:#111;
  border:1px solid #333;
  padding:6px 8px;
  font-size:11px;
  white-space:nowrap;
  opacity:0;
  pointer-events:none;
  transition:.2s ease;
  border-radius:8px;
}

.timeline-step:hover::after{
  opacity:1;
}

</style>
</head>

<body>
<div class="wrapper">

<header class="hero">
  <div class="hero-inner">

  <div id="authBox" class="auth-box">
    <span id="authState">üë§ Nicht eingeloggt</span>
    <button id="loginBtn">Login</button>
    <button id="registerBtn">Registrieren</button>
  </div>

    <h1 class="hero-logo"><img src="img/logo_d2r.png" alt="D2R Lootliste Logo"></h1>
    <p>Community Lootliste ¬∑ Diablo II Resurrected ¬∑ Non-Ladder</p>

    <div class="hero-stats" id="heroStats"></div>

    <div class="hero-right">
      
      <div id="visitorCounter">üëÅ Besucher gesamt: ‚Ä¶</div>
    </div>
  </div>
</header>
  <div class="rules-bar">
  <a href="verfahren.html">‚ìò Ablauf & Regeln der Lootliste</a>
</div>

<div class="icon-bar" id="iconBar"></div>
  
  <!-- ===== PROJECT TIMELINE (INDEX) ===== -->
<div class="project-timeline">

  <div class="timeline-track">
    <div class="timeline-progress"></div>
  </div>

  <div class="timeline-steps">
<div class="timeline-step done" data-tip="Erste Lootliste (manuell)">
  <span>Liste</span>
</div>

    <div class="timeline-step done" data-tip="V1: Erste Lootliste, manuell gepflegt">
      <span>V1</span>
    </div>

    <div class="timeline-step done" data-tip="V2: Admin, Status, Filter">
      <span>V2</span>
    </div>

    <div class="timeline-step current" data-tip="V3: Systemlogik, Anfragen, UX">
      <span>V3</span>
    </div>

    <div class="timeline-step future" data-tip="Ausblick: Accounts & Vergabe-Phasen">
      <span>‚Üí</span>
    </div>
  </div>

</div>

<div class="container">

<div class="meta-bar">
  <span id="metaStats"></span>
  </div>

<div class="filter-panel">
  <input id="search" placeholder="Item suchen‚Ä¶">

  <select id="statusFilter">
    <option value="">Alle Status</option>
    <option>Verf√ºgbar</option>
    <option>Reserviert</option>
    <option>Vergeben</option>
  </select>

  <select id="sortRating">
    <option value="desc">Rating ‚Üì</option>
    <option value="asc">Rating ‚Üë</option>
  </select>
</div>

<div class="request-feed">
  <h3>üì¨ Letzte Anfragen</h3>
  <div id="requestFeed"></div>
</div>


<div class="rating-hint">
  ‚ìò Item-Bewertungen dienen der Orientierung und einem einheitlichen roten Faden ‚Äì die Community entscheidet.
</div>


<div class="cards" id="cards"></div>
</div> <!-- container -->

<footer class="footer">
</div>

<!-- ===== REQUEST MODAL ===== -->
<div id="requestModal">
  <div class="backdrop"></div>
  <div class="modal">
    <strong id="modalItem"></strong>
    <input id="reqName" placeholder="Dein Nickname *">
    <input id="reqContact" placeholder="Kontakt (Mail oder Discord) *">
    <textarea id="reqMsg" placeholder="Nachricht (optional)"></textarea>
    <div class="modal-actions">
      <button id="sendReq">Anfrage senden</button>
      <button id="closeReq">Abbrechen</button>
    </div>
  </div>
</div>

<script type="module">
  const STATUS_MAP = {
    approved: "Verf√ºgbar",
    reserved: "Reserviert",
    given: "Vergeben"
  };

  /* ===== SIM MODE ===== */
  const SIM_MODE = true;

  function getSimStatus(itemName, fallback){
    if(!SIM_MODE) return fallback;
    return localStorage.getItem("sim_status_" + itemName) || fallback;
  }

  function setSimStatus(itemName, status){
    if(!SIM_MODE) return;
    localStorage.setItem("sim_status_" + itemName, status);
  }

      /* ===== CURRENT USER (LOCAL / DEV) ===== */
  const CURRENT_USER =
    localStorage.getItem("loot_current_user")
    || ("guest_" + Math.random().toString(36).slice(2));

  localStorage.setItem("loot_current_user", CURRENT_USER);

/* ===== ICON MAPPING ===== */
const ICONS = {
  waffe: "waffe",
  helm: "helm",
  ruestung: "ruestung",
  schild: "schild",
  guertel: "guertel",
  handschuhe: "handschuhe",
  amulett: "amulett",
  ring: "ring",
  charm: "charm",
  rune: "rune",
  sonstiges: "sonstiges"
};
  
  /* ===== TYPE LABELS (Anzeige) ===== */
const TYPE_LABELS = {
  waffe: "Waffe",
  helm: "Helm",
  ruestung: "R√ºstung",
  schild: "Schild",
  guertel: "G√ºrtel",
  handschuhe: "Handschuhe",
  amulett: "Amulett",
  ring: "Ring",
  charm: "Charm",
  rune: "Rune",
  sonstiges: "Sonstiges"
};

  const WEAPON_ICONS = {
  "Schwert": "schwert",
  "Axt": "axt",
  "Keule": "keule",
  "Stab": "stab",
  "Speer": "speer",
  "Dolch": "dolch",
  "Zauberstab": "zauberstab",
  "Bogen": "bogen",
  "Armbrust": "armbrust",
  "Wurfwaffe": "wurfwaffe",
  "Sense": "sense",
  "Klaue": "klaue",
  "Zepter": "zepter"
};

/* ===== DOM ===== */
const iconBar=document.getElementById("iconBar");
const cards=document.getElementById("cards");
const search=document.getElementById("search");
const statusFilter=document.getElementById("statusFilter");
const sortRating=document.getElementById("sortRating");
const metaBar=document.getElementById("metaBar");
const heroStats=document.getElementById("heroStats");
const visitorCounter=document.getElementById("visitorCounter");
const requestFeed=document.getElementById("requestFeed");

const modal=document.getElementById("requestModal");
const modalItem=document.getElementById("modalItem");
const reqName=document.getElementById("reqName");
const reqContact=document.getElementById("reqContact");
const reqMsg=document.getElementById("reqMsg");

let activeType="";
let currentItem="";

/* ===== ICON BAR BUILD ===== */
Object.keys(ICONS).forEach(type=>{
  const btn=document.createElement("div");
  btn.className="icon-btn";
  btn.innerHTML=`<img src="img/icons/${ICONS[type]}.png"><span>${TYPE_LABELS[type] || type}</span>`;
  
btn.onclick = () => {
  document.querySelectorAll(".icon-btn")
    .forEach(b => b.classList.remove("active"));

  if (activeType === type) {
    activeType = "";
  } else {
    activeType = type;
    btn.classList.add("active");
  }

  render();
  renderRequestFeed();
};

  iconBar.appendChild(btn);
});
  
/* ===== HELPERS ===== */
  function loadRequests(){
  return JSON.parse(localStorage.getItem("loot_requests") || "[]");
}

function hasRequested(itemName){
  const data = loadRequests();
  return data.some(
    r => r.item === itemName && r.user === CURRENT_USER
  );
}

  function renderRequestFeed(){
  const data = loadRequests();
  requestFeed.innerHTML = "";

  if (!data.length) {
    requestFeed.innerHTML =
      `<div class="request-entry">Noch keine Anfragen</div>`;
    return;
  }

  // Neueste zuerst, maximal 5 Eintr√§ge
  data
    .slice()
    .reverse()
    .slice(0, 5)
    .forEach(r => {
      const t = new Date(r.time);
      const mins = Math.max(
        1,
        Math.floor((Date.now() - t.getTime()) / 60000)
      );

      requestFeed.innerHTML += `
        <div class="request-entry"
             data-item="${r.item}"
             style="cursor:pointer">
          <strong>${r.name}</strong>
          interessiert sich f√ºr
          <em>${r.item}</em>
          <span style="opacity:.6">¬∑ vor ${mins} min</span>
        </div>
      `;
    });
}

/* ===== RENDER ===== */

// ===== BACKEND ITEMS =====
let items = [];

async function loadItems() {
  try {
    const res = await fetch(
      "https://content-connection-production-ea07.up.railway.app/api/items/public"
    );
    const data = await res.json();
   console.log("PUBLIC ITEMS DATA:", data);
console.log("TYPE:", Array.isArray(data), typeof data);

items = Array.isArray(data)
  ? data.map(i => {

      // üîç Debug: Rohdaten aus dem Backend

      // ‚≠ê Rating normalisieren
    
const ratingValue = Number(i.rating) || 0;

      // ‚úÖ √ñffentliches Item-Objekt
      return {
        id: i.id,

name: i.name || ("item_" + i.id),

        type: i.type || "sonstiges",
        category: i.type || "",
        weaponType: i.weaponType || "",

        // ‚≠ê Sterne f√ºr UI
        stars: "‚òÖ".repeat(ratingValue),
rating: ratingValue,

        quality: i.quality || "",
        roll: i.roll || "",

        contact: i.contact || "",
        status: STATUS_MAP[i.status] || "Verf√ºgbar",

        screenshot: i.screenshot || ""
      };
    })
  : [];

  } catch (e) {
    console.error("Public Items konnten nicht geladen werden", e);
    items = [];
  }
}
  
function resolveImageSrc(src) {
  if (!src) return "img/icons/default.png";
  return src.startsWith("http")
    ? src
    : "https://content-connection-production-ea07.up.railway.app" + src;
}

function render() {
  cards.innerHTML = "";

  const filtered = items
    .filter(i => {
      const q = search.value.toLowerCase();
      const statusValue = statusFilter.value;

      const matchesSearch =
        !q ||
        (i.name || "").toLowerCase().includes(q) ||
        (i.category || "").toLowerCase().includes(q);

const matchesStatus =
  !statusValue || getSimStatus(i.name, i.status) === statusValue;

      const matchesType =
        !activeType || i.type === activeType;

      return matchesSearch && matchesStatus && matchesType;
    })
   .sort((a, b) => {
  return sortRating.value === "asc"
    ? (a.rating || 0) - (b.rating || 0)
    : (b.rating || 0) - (a.rating || 0);
});

const total = items.length;
const frei = items.filter(i =>
  getSimStatus(i.name, i.status) === "Verf√ºgbar"
).length;
const res = items.filter(i =>
  getSimStatus(i.name, i.status) === "Reserviert"
).length;
const weg = items.filter(i =>
  getSimStatus(i.name, i.status) === "Vergeben"
).length;

  heroStats.innerHTML = `
    <div>üì¶ ${total} Items</div>
    <div style="color:var(--green)">üü¢ ${frei} verf√ºgbar</div>
    <div style="color:var(--yellow)">üü° ${res} reserviert</div>
    <div style="color:var(--red)">üî¥ ${weg} vergeben</div>
  `;

document.getElementById("metaStats").textContent =
  `üì¶ ${filtered.length} Treffer ¬∑ üïí ${new Date().toLocaleDateString("de-DE")}`;

  filtered.forEach(item => {
      const currentStatus = getSimStatus(item.name, item.status);

const s =
  currentStatus === "Reserviert" ? "reserviert" :
  currentStatus === "Vergeben" ? "vergeben" :
  "verfuegbar";

  cards.innerHTML += `
<div class="card ${s}" data-item="${item.name}">
      <span class="status-badge ${s}">${currentStatus}</span>

      <div class="card-image"
        ${item.screenshot ? `data-screenshot="${item.screenshot}"` : ""}>
        <img src="img/icons/${
          item.type === "waffe" && item.weaponType
            ? (WEAPON_ICONS[item.weaponType] || "waffe")
            : (ICONS[item.type] || "default")
        }.png">
      </div>

      <div class="card-body">
      
<div class="item-name ${item.quality || ""}">
  ${item.name}
</div>

<div class="item-sub">
  ${
    item.type === "waffe"
      ? `Waffe ¬∑ ${item.weaponType}`
      : (TYPE_LABELS[item.type] || "")
  }
</div>

${item.roll ? `<div class="roll">${item.roll}</div>` : ""}

<div class="stars">
  <span class="stars-filled">${"‚òÖ".repeat(item.rating)}</span>
  <span class="stars-empty">${"‚òÜ".repeat(5 - item.rating)}</span>
  <span class="stars-sep">|</span>
  <span class="stars-num">${item.rating}/5</span>
</div>

        <div class="player">
          Spieler: ${item.contact || "-"}
        </div>

${
  currentStatus === "Verf√ºgbar"
    ? (
        hasRequested(item.name)
          ? `<button class="request-btn disabled" disabled>
               Bedarf angemeldet
             </button>`
          : `<button class="request-btn" data-item="${item.name}">
               üì© Bedarf anmelden
             </button>`
      )
    : ``
}

      </div>
    </div>
  `;
});
  
  renderRequestFeed();

  }

document.getElementById("sendReq").onclick = () => {

  // 1Ô∏è‚É£ Pflichtfelder pr√ºfen
  if (!reqName.value || !reqContact.value) {
    alert("Bitte Pflichtfelder ausf√ºllen");
    return;
  }

  // 2Ô∏è‚É£ Doppelklick-/Spam-Schutz
  const sendBtn = document.getElementById("sendReq");
  if (sendBtn.disabled) return;
  sendBtn.disabled = true;

  // 3Ô∏è‚É£ Anfrage speichern
  const data = JSON.parse(localStorage.getItem("loot_requests") || "[]");
  data.push({
    item: currentItem,
    user: CURRENT_USER,
    name: reqName.value,
    contact: reqContact.value,
    msg: reqMsg.value,
    time: new Date().toISOString()
  });

  localStorage.setItem("loot_requests", JSON.stringify(data));

  // 4Ô∏è‚É£ Cleanup
  reqName.value = "";
  reqContact.value = "";
  reqMsg.value = "";

  modal.style.display = "none";

  // 5Ô∏è‚É£ Re-render + Button freigeben
loadItems().then(() => {
  render();
  renderRequestFeed();   // Feed nach neuer Anfrage aktualisieren
  sendBtn.disabled = false;
});
};

/* ===== VISITOR COUNTER ===== */
const K="lootliste_visitors",D="lootliste_last_visit";
const today=new Date().toDateString();
if(localStorage.getItem(D)!==today){
  localStorage.setItem(K,(+localStorage.getItem(K)||0)+1);
  localStorage.setItem(D,today);
}
visitorCounter.innerHTML =
  '&#128065; Besucher gesamt: <b>' + localStorage.getItem(K) + '</b>';
  
/* ===== REQUEST BUTTON CLICK (DELEGATION) ===== */
cards.addEventListener("click", e => {
  const btn = e.target.closest(".request-btn");
  if (!btn || btn.classList.contains("disabled")) return;

  currentItem = btn.dataset.item;
  modalItem.textContent = currentItem;
  modal.style.display = "block";
});

/* ===== REQUEST FEED CLICK (HIGHLIGHT ITEM) ===== */
requestFeed.addEventListener("click", e => {
  const entry = e.target.closest(".request-entry");
  if (!entry) return;

  const itemName = entry.dataset.item;
  if (!itemName) return;

  const card = document.querySelector(
    `.card[data-item="${CSS.escape(itemName)}"]`
  );
  if (!card) return;

  card.scrollIntoView({
    behavior: "smooth",
    block: "center"
  });

// üëá alle bestehenden Highlights sofort entfernen
document.querySelectorAll(".card.highlight")
  .forEach(c => c.classList.remove("highlight"));

card.classList.add("highlight");

setTimeout(() => {
  card.classList.remove("highlight");
}, 2000);
});

/* ===== INIT ===== */
search.oninput=render;
statusFilter.onchange=render;
sortRating.onchange=render;
loadItems().then(() => {
  render();
});



</script>


<!-- ===== AUTH (FINAL / LOCAL BACKEND) ===== -->
<!-- DISABLED AUTH BLOCK (DEV MODE) 
<script>
const API = "http://localhost:3000";

const authState = document.getElementById("authState");
const authModal = document.getElementById("authModal");
const authTitle = document.getElementById("authTitle");
const authName = document.getElementById("authName");
const authPass = document.getElementById("authPass");
const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");
const authSubmit = document.getElementById("authSubmit");
const authClose = document.getElementById("authClose");

loginBtn.onclick = () => { return; /* AUTH INAKTIV ‚Äì Backend folgt */
  authTitle.textContent = "Login";
  authModal.style.display = "block";
};

registerBtn.onclick = () => { return; /* AUTH INAKTIV ‚Äì Backend folgt */
  authTitle.textContent = "Registrieren";
  authModal.style.display = "block";
};

authClose.onclick = () => authModal.style.display = "none";

authSubmit.onclick = async () => { return; /* AUTH INAKTIV ‚Äì Backend folgt */
  const mode = authTitle.textContent === "Registrieren" ? "register" : "login";
  const username = authName.value.trim();
  const password = authPass.value.trim();

  if (!username || !password) {
    alert("Bitte Benutzername und Passwort eingeben");
    return;
  }

  try {
    const res = await fetch(`${API}/${mode}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.error || "Fehler");
      return;
    }

    localStorage.setItem("loot_user", JSON.stringify(data.user));
    authState.textContent = "üë§ " + data.user.username;
    authModal.style.display = "none";
    authName.value = "";
    authPass.value = "";
  } catch {
    alert("Backend nicht erreichbar");
  }
};

// Auto-Login
const saved = localStorage.getItem("loot_user");
if (saved) {
  try {
    const u = JSON.parse(saved);
    authState.textContent = "üë§ " + u.username;
  } catch {}
}
</script>
END DISABLED AUTH BLOCK -->








<footer class="footer">
<div class="footer-links">
  <a href="ueber-das-projekt.html">√úber das Projekt</a>
  <span class="sep">¬∑</span>
  <a href="entwickler.html">√úber den Entwickler</a>
  <span class="sep">¬∑</span>
  <a href="impressum.html">Impressum</a>
  <span class="sep">¬∑</span>
  <a href="datenschutz.html">Datenschutz</a>
</div>

  <div class="footer-copy">
    ¬© 2025 D2R Lootliste
  </div>
</footer>

  <!-- ===== SCREENSHOT OVERLAY ===== -->
<div id="screenshotOverlay" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  z-index:9999;
  align-items:center;
  justify-content:center;
">
  <img id="overlayImage" style="
    max-width:90%;
    max-height:90%;
    border-radius:12px;
    box-shadow:0 0 40px rgba(0,0,0,.8);
  ">
</div>

  <!-- ===== SCREENSHOT OVERLAY SCRIPT ===== -->
<script>
const overlay = document.getElementById("screenshotOverlay");
const overlayImg = document.getElementById("overlayImage");

document.addEventListener("click", e => {
  const el = e.target.closest("[data-screenshot]");
  if (!el) return;

  const src = el.dataset.screenshot;
  if (!src) return;

  overlayImg.src =
    "https://content-connection-production-ea07.up.railway.app" + src;

  overlay.style.display = "flex";
});

overlay.addEventListener("click", () => {
  overlay.style.display = "none";
  overlayImg.src = "";
});

document.addEventListener("keydown", e => {
  if (e.key === "Escape") {
    overlay.style.display = "none";
    overlayImg.src = "";
  }
});
</script>

<!-- ===== DISABLED AUTH BLOCK (DEV MODE) ===== -->
  <!--
<script>
const authModal = document.getElementById("authModal");
const authTitle = document.getElementById("authTitle");
const authClose = document.getElementById("authClose");

const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");

if (loginBtn) {
  loginBtn.onclick = () => {
    authTitle.textContent = "Login";
    authModal.style.display = "block";
  };
}

if (registerBtn) {
  registerBtn.onclick = () => {
    authTitle.textContent = "Registrieren";
    authModal.style.display = "block";
  };
}

if (authClose) {
  authClose.onclick = () => {
    authModal.style.display = "none";
  };
}
</script>
  -->

  </body>  
</html>
