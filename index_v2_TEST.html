<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>ğŸ Free Lootliste â€“ Community Items | D2R Non-Ladder (v2.2)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== DEIN BESTEHENDES CSS ===== */
/* unverÃ¤ndert â€“ nur unten ergÃ¤nzt */

.admin-btn{
  padding:12px 18px;
  border-radius:14px;
  background:#151515;
  border:1px solid var(--border);
  color:#fff;
  cursor:pointer;
}
.admin-btn.active{
  border-color:var(--gold);
  color:var(--gold);
}

.admin-actions{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.admin-actions button{
  flex:1;
  font-size:12px;
  padding:6px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#111;
  color:#fff;
  cursor:pointer;
}
.admin-actions button:hover{
  border-color:var(--gold);
  color:var(--gold);
}

#adminModal{display:none}
#adminModal .backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  z-index:100;
}
#adminModal .modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#121212;
  border:1px solid var(--border);
  border-radius:18px;
  padding:22px;
  width:90%;
  max-width:360px;
  z-index:101;
  display:flex;
  flex-direction:column;
  gap:10px;
}
</style>
</head>

<body>
<div class="wrapper">

<header class="hero">
  <div class="hero-inner">
    <h1>ğŸ <span>FREE LOOTLISTE</span></h1>
    <p>Community Items Â· Diablo II Resurrected Â· Non-Ladder</p>

    <div class="hero-stats" id="heroStats"></div>

    <div class="hero-right">
      <a class="twitch" href="https://www.twitch.tv/me_solli" target="_blank">
        â–¶ Twitch: me_solli
      </a>
      <button id="adminBtn" class="admin-btn">ğŸ” Admin</button>
      <div id="visitorCounter">ğŸ‘ Besucher gesamt: â€¦</div>
    </div>
  </div>
</header>

<div class="icon-bar" id="iconBar"></div>

<div class="container">
  <div class="meta-bar" id="metaBar"></div>
  <div class="filter-panel">
    <input id="search" placeholder="Item suchenâ€¦">
    <select id="statusFilter">
      <option value="">Alle Status</option>
      <option>VerfÃ¼gbar</option>
      <option>Reserviert</option>
      <option>Vergeben</option>
    </select>
    <select id="sortRating">
      <option value="desc">Rating â†“</option>
      <option value="asc">Rating â†‘</option>
    </select>
  </div>

  <div class="request-feed">
    <h3>ğŸ“¬ Letzte Anfragen</h3>
    <div id="requestFeed"></div>
  </div>

  <div class="cards" id="cards"></div>
</div>

<footer>
  <a href="impressum.html">Impressum</a>
  <a href="datenschutz.html">Datenschutz</a>
</footer>
</div>

<!-- ===== ADMIN MODAL ===== -->
<div id="adminModal">
  <div class="backdrop"></div>
  <div class="modal">
    <strong>Admin Login</strong>
    <input id="adminPass" type="password" placeholder="Passwort">
    <button id="adminLogin">Login</button>
  </div>
</div>

<script type="module">
import baseItems from "./items.js";

/* ===== ADMIN ===== */
const ADMIN_PW="lootadmin";
let isAdmin=sessionStorage.getItem("loot_admin")==="1";

const adminBtn=document.getElementById("adminBtn");
const adminModal=document.getElementById("adminModal");

adminBtn.onclick=()=>{
  if(isAdmin){
    sessionStorage.removeItem("loot_admin");
    location.reload();
  }else adminModal.style.display="block";
};

document.getElementById("adminLogin").onclick=()=>{
  if(document.getElementById("adminPass").value===ADMIN_PW){
    sessionStorage.setItem("loot_admin","1");
    location.reload();
  }else alert("Falsches Passwort");
};

/* ===== ITEMS SOURCE ===== */
let items=JSON.parse(localStorage.getItem("loot_items")||"null")||structuredClone(baseItems);

/* ===== ICONS ===== */
const ICONS={
  "Waffe":"waffe","Helm":"helm","RÃ¼stung":"ruestung","Schild":"schild",
  "GÃ¼rtel":"guertel","Handschuhe":"handschuhe","Amulett":"amulett",
  "Ring":"ring","Charm":"charm","Rune":"rune","Sonstiges":"sonstiges"
};

/* ===== DOM ===== */
const cards=document.getElementById("cards");
const search=document.getElementById("search");
const statusFilter=document.getElementById("statusFilter");
const sortRating=document.getElementById("sortRating");
const heroStats=document.getElementById("heroStats");
const requestFeed=document.getElementById("requestFeed");

/* ===== HELPERS ===== */
const ratingValue=s=>(s?.match(/â˜…/g)||[]).length;
const save=()=>localStorage.setItem("loot_items",JSON.stringify(items));

/* ===== RENDER ===== */
function render(){
  cards.innerHTML="";

  const filtered=items.filter(i=>{
    const q=search.value.toLowerCase();
    return(
      (!statusFilter.value||i.status===statusFilter.value) &&
      (i.name.toLowerCase().includes(q)||i.category.toLowerCase().includes(q))
    );
  }).sort((a,b)=>{
    const d=ratingValue(b.stars)-ratingValue(a.stars);
    return sortRating.value==="desc"?d:-d;
  });

  heroStats.innerHTML=`
    <div>ğŸ“¦ ${items.length} Items</div>
    <div style="color:var(--green)">ğŸŸ¢ ${items.filter(i=>i.status==="VerfÃ¼gbar").length}</div>
    <div style="color:var(--yellow)">ğŸŸ¡ ${items.filter(i=>i.status==="Reserviert").length}</div>
    <div style="color:var(--red)">ğŸ”´ ${items.filter(i=>i.status==="Vergeben").length}</div>
  `;

  filtered.forEach((item,i)=>{
    const s=item.status==="Reserviert"?"reserviert":item.status==="Vergeben"?"vergeben":"verfuegbar";
    cards.innerHTML+=`
      <div class="card">
        <span class="status-badge ${s}">${item.status}</span>
        <img src="img/icons/${ICONS[item.type]||"default"}.png">
        <div class="card-body">
          <div class="item-name">${item.name}</div>
          <div class="stars">${item.stars} (${ratingValue(item.stars)}/5)</div>
          ${isAdmin?`
          <div class="admin-actions">
            <button onclick="setStatus(${i},'VerfÃ¼gbar')">ğŸŸ¢</button>
            <button onclick="setStatus(${i},'Reserviert')">ğŸŸ¡</button>
            <button onclick="setStatus(${i},'Vergeben')">ğŸ”´</button>
          </div>`:""}
        </div>
      </div>`;
  });
}

window.setStatus=(i,s)=>{
  items[i].status=s;
  save();
  render();
};

/* ===== INIT ===== */
search.oninput=render;
statusFilter.onchange=render;
sortRating.onchange=render;
render();
</script>
</body>
</html>
