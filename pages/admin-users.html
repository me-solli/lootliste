<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì User √úbersicht</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --gold:#f5c451;
  --border:#2a2a2a;
  --green:#4cff4c;
  --yellow:#f0e68c;
  --red:#ff6b6b;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(ellipse at top,#181818 0%,#090909 65%);
  color:#eaeaea;
}

.wrapper{
  max-width:1400px;
  margin:0 auto;
  padding:28px;
}

h1{
  margin:0 0 18px;
}

/* ===== TABLE ===== */
.table-wrap{
  background:#0f0f0f;
  border:1px solid #222;
  border-radius:18px;
  overflow:hidden;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

th,td{
  padding:10px;
  border-bottom:1px solid #222;
  text-align:left;
}

th{
  color:#aaa;
  font-weight:500;
}

/* ===== BADGES ===== */
.badge{
  padding:3px 8px;
  border-radius:999px;
  font-size:11px;
  border:1px solid #333;
  background:#111;
}

.badge.active{color:var(--green)}
.badge.restricted{color:var(--yellow)}

/* ===== ACTIONS ===== */
button{
  padding:6px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#111;
  color:#eaeaea;
  cursor:pointer;
  font-size:12px;
}

button.warn{
  border-color:var(--yellow);
  color:var(--yellow);
}

button.ok{
  border-color:var(--green);
  color:var(--green);
}

.note{
  margin-top:14px;
  font-size:12px;
  color:#aaa;
}
</style>
</head>

<body>

<div class="wrapper">
  <h1>üë• Admin ‚Äì User √úbersicht</h1>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Status</th>
          <th>Items gespendet</th>
          <th>Items erhalten</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <div class="note">
    ‚ö†Ô∏è Einschr√§nkungen sind <strong>lokal (Admin-seitig)</strong> gespeichert.<br>
    Kein Backend, keine globale Sperre ‚Äì nur Moderationshilfe.
  </div>
</div>

<script>
const API = "https://lootliste-production.up.railway.app";
const STORAGE_KEY = "lootliste_restricted_users";

/* ===== AUTH ===== */
const accountId = localStorage.getItem("lootliste_account_id");
if(!accountId){
  document.body.innerHTML = "<div style='padding:30px'>Nicht eingeloggt.</div>";
  throw new Error("No account id");
}

/* ===== STORAGE ===== */
function getRestricted(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
}

function setRestricted(data){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/* ===== LOAD ===== */
async function load(){
  const [users, items] = await Promise.all([
    fetch(API + "/accounts",{
      headers:{ "X-Account-Id": accountId }
    }).then(r=>r.json()),
    fetch(API + "/items").then(r=>r.json())
  ]);

  render(users, items, getRestricted());
}

/* ===== RENDER ===== */
function render(users, items, restricted){
  userTable.innerHTML = "";

  users.forEach(u=>{
    const donated = items.filter(i=>i.donor === u.username).length;
    const received = items.filter(i=>i.receiver === u.username).length;
    const isRestricted = !!restricted[u.username];

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.username}</td>
      <td>
        <span class="badge ${isRestricted ? "restricted" : "active"}">
          ${isRestricted ? "eingeschr√§nkt" : "aktiv"}
        </span>
      </td>
      <td>${donated}</td>
      <td>${received}</td>
      <td>
        ${
          isRestricted
            ? `<button class="ok" onclick="unrestrict('${u.username}')">freigeben</button>`
            : `<button class="warn" onclick="restrict('${u.username}')">einschr√§nken</button>`
        }
      </td>
    `;
    userTable.appendChild(tr);
  });
}

/* ===== ACTIONS ===== */
function restrict(username){
  const data = getRestricted();
  data[username] = { since: new Date().toISOString() };
  setRestricted(data);
  load();
}

function unrestrict(username){
  const data = getRestricted();
  delete data[username];
  setRestricted(data);
  load();
}

load();
</script>

</body>
</html>
